<!doctype html>
<html lang="en">
<link rel="icon" type="image/png" href="/assets/img/favicon.png" >
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="search-domain" value="https://revbayes.github.io/">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <title>RevBayes: Episodic Diversification Rate Estimation</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <a href="/" class="pull-left">
        
        <img class="navbar-logo" src="/assets/img/aquabayes-desaturated.png" alt="RevBayes Home" />
        
      </a>
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar" align="right"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="/download">Download</a></li>
        <li><a href="/tutorials/">Tutorials</a></li>
        <li><a href="/documentation/">Documentation</a></li>
        <li><a href="https://revbayes.github.io/revscripter/">RevScripter</a></li>
        <li><a href="/workshops/">Workshops</a></li>
        <li><a href="/jobs/">Jobs</a></li>
        <li><a href="/developer/">Developer</a></li>
      </ul>
      <!-- <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form> -->
    </div>
  </div>
</nav>

      <div class="titlebar">
	<h1 class="maintitle">Episodic Diversification Rate Estimation</h1>
	<h3 class="subtitle">Estimating Rate-Variation Through Time in Diversification Rates</h3>
	<h4 class="authors">Sebastian Höhna and Andrew Magee</h4>
  <h5>Last modified on January 14, 2021</h5>
</div>


<div class="sidebar no-print">
<blockquote class="overview" id="overview">
  <h2>Overview</h2>
  
  <div class="row">
    <div class="col-md-9">
        <strong>Prerequisites</strong>
        
          <ul id="prerequisites">
          
            <li><a href="/tutorials/intro/">Getting Started with RevBayes and Rev Language Syntax</a></li>
          
            <li><a href="/tutorials/mcmc/">Introduction to Markov chain Monte Carlo (MCMC) Sampling</a></li>
          
            <li><a href="/tutorials/divrate/div_rate_intro.html">Introduction to Diversification Rate Estimation</a></li>
          
            <li><a href="/tutorials/divrate/simple.html">Simple Diversification Rate Estimation</a></li>
          
          </ul>
        
    </div>
  </div>
  
</blockquote>





<blockquote class="tutorial_files" id="tutorial_files">
    <h2>Data files and scripts</h2>
    
        
        <strong>Data Files</strong>
        <ul id="data_files">
        
        
        
          <li><a href="/tutorials/divrate/data/primates.tre">primates.tre</a></li>
        
          <li><a href="/tutorials/divrate/data/primates_tree.nex">primates_tree.nex</a></li>
        
          <li><a href="/tutorials/sse/data/primates_tree.nex">primates_tree.nex</a></li>
        
        </ul>
    
        
        <strong>Scripts</strong>
        <ul id="scripts">
        
        
        
          <li><a href="/tutorials/divrate/scripts/mcmc_EBD.Rev">mcmc_EBD.Rev</a></li>
        
          <li><a href="/tutorials/divrate/scripts/plot_EBD.R">plot_EBD.R</a></li>
        
        </ul>
    
</blockquote>


</div>
<h2 class="section" id="overview">Overview</h2>
<hr class="section" />

<p>This tutorial describes how to specify an episodic birth-death model in <code class="highlighter-rouge">RevBayes</code>.
The episodic birth-death model is a process where diversification rates vary episodically through time 
and are modeled as piecewise-constant rates <a class="citation" href="#Stadler2011">(Stadler 2011; Höhna 2015)</a>.
The probabilistic graphical model is given once at the beginning of this tutorial.
Your goal is to estimate speciation and extinction rates through-time using 
Markov chain Monte Carlo (MCMC).</p>

<p>You should read first the <a href="/tutorials/divrate/div_rate_intro.html">Introduction to Diversification Rate Estimation</a>
which explains the theory and gives some general overview of diversification rate estimation 
and <a href="/tutorials/divrate/simple.html">Simple Diversification Rate Estimation</a> which goes through a very simple pure birth and birth-death model
for estimating diversification rates.</p>

<h2 class="section" id="models">Episodic Diversification Rate Models</h2>
<hr class="section" />

<p>The basic idea behind the model is that speciation and extinction rates are constant
within time intervals but can be different between time intervals.
Thus, we will divide time into equally sized intervals.
An overview of the underlying theory of the specific model and implementation
is given in <a class="citation" href="#Hoehna2015a">(Höhna 2015)</a>.</p>

<figure id="fig_EBD"><p><img src="figures/EBD_scenarios.png" width="75%" height="75%" /></p>
<figcaption>Two scenarios of birth-death models. On the left we show constant diversification.
On the right we show an example of an episodic birth-death process where rates
are constant in each time interval (epoch). The top panel of this figure shows
an example realization under the given rates.</figcaption>
</figure>

<p><a href="#fig_EBD"></a> shows an example of a constant rate birth-death process and
an episodic birth-death process.</p>

<p>We assume that the log-transformed rates follow a Horseshoe Markov random field (HSMRF) prior distribution <a class="citation" href="#Magee2020">Magee et al. (2020)</a>.
This prior assumes that rates are autocorrelated, that is, rates in the current time interval will be centered around the rates in the previous time interval.
The assumption of autocorrelated rates does not only makes sense biologically but also improves our ability to estimate parameters.
The HSMRF allows for periods of relatively constant rates interspersed with large jumps, and can be used with large numbers of intervals (hundreds) to provide fine-scale detail in estimated rates.</p>

<figure id="fig_EBD_GM"><p><img src="figures/graphical_model_EBD.png" width="75%" height="75%" /></p>
<figcaption>A graphical model with the outline of the <code class="highlighter-rouge">Rev</code> code. On the left we see a
 graphical model describing the HSMRF model for rate-variation through time.
On the right we show the corresponding <code class="highlighter-rouge">Rev</code> commands to instantiate this model.
This figure gives a complete overview of the model that we use here in this analysis.
There are many ways to represent the HSMRF model, this one is easy to read, but
more computationally burdensome than the version we will use in practice.</figcaption>
</figure>

<p>We show an idealized graphical model of the episodic birth-death process with autocorrelated rates
in <a href="#fig_EBD_GM"></a>.
This graphical model shows you which variables are included in the model,
and the dependency between the variables.
Thus, it makes the structure and assumption of the model clear and
visible instead of a black-box <a class="citation" href="#Hoehna2014b">(Höhna et al. 2014)</a>.
For example, you see how the speciation and extinction rates in each time interval
depend on the rates of the previous interval, and that we use a hyperprior for
the standard deviation of rates between time intervals.
Note that the actual set up of the plates in Rev code will appear to differ from what is shown here.
This is because there are many ways to represent the HSMRF model, and with some
small reparameterization and a function to replace the plate(s), we can make
it run much more efficiently and easily in MCMC.</p>

<h2 class="section" id="estimating-episodic-diversification-rates">Estimating Episodic Diversification Rates</h2>
<hr class="section" />

<h3 class="subsection" id="read-the-tree">Read the tree</h3>
<hr class="subsection" />

<p>Begin by reading in the ``observed’’ tree.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>T &lt;- readTrees("data/primates_tree.nex")[1]
</code></pre></div></div>
<p>From this tree, we get some helpful variables, such as the taxon information which we need to instantiate the birth-death process.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>taxa &lt;- T.taxa()
</code></pre></div></div>
<p>Additionally, we initialize a variable for our vector of moves and monitors.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>moves    = VectorMoves()
monitors = VectorMonitors()
</code></pre></div></div>

<p>Finally, we create a helper variable that specifies the number of intervals.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NUM_INTERVALS = 10
NUM_BREAKS := NUM_INTERVALS - 1
</code></pre></div></div>
<p>Using this variable we can easily change our script to break-up time into many (e.g., <code class="highlighter-rouge">NUM_INTERVALS = 100</code>).</p>

<h3 class="subsection" id="specifying-the-model">Specifying the model</h3>
<hr class="subsection" />

<h4 class="subsubsection" id="priors-on-amount-of-rate-variation">Priors on amount of rate variation</h4>
<hr class="subsubsection" />

<p>We start by specifying prior distributions on the rates.
The overall model is a HSMRF birth-death model.
In this model, the changes in log-scale rates between intervals follow a Horseshoe distribution <a class="citation" href="#Carvalho2010">Carvalho et al. (2010)</a>, which allows for large jumps in rate while assuming most changes are very small.
We need a parameter to control the overall variability from present to past in the diversification rates, the global scale parameter.
We must also set the global scale hyperprior, which acts with the global scale parameter to set the prior on rate variability.
In this example, we use 10 speciation and extinction rate intervals, but the HSMRF enables us to use much larger numbers.
The global scale hyperprior should be set based on how many intervals are used, in the case of 100 intervals, use 0.0021.
RevGadgets provides the function <code class="highlighter-rouge">setMRFGlobalScaleHyperpriorNShifts()</code> to compute this parameter for other numbers of intervals.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>speciation_global_scale_hyperprior &lt;- 0.044
extinction_global_scale_hyperprior &lt;- 0.044

speciation_global_scale ~ dnHalfCauchy(0,1)
extinction_global_scale ~ dnHalfCauchy(0,1)

</code></pre></div></div>

<h4 class="subsubsection" id="specifying-episodic-rates">Specifying episodic rates</h4>
<hr class="subsubsection" />

<p>As we mentioned before, we will apply HSMRF distributions as prior for the log-transformed speciation and extinction rates.
We begin with the rates at the present which is our initial rate parameter.
The rates at the present will be specified slightly differently
because they are not correlated to any previous rates.
This is because we are actually modeling rate-changes backwards in time and
there is no previous rate for the rate at the present.
Modeling rates backwards in time makes it easier for us if we had some prior information
about some event affected diversification sometime before the present,
<em>e.g.,</em> 25 million years ago.</p>

<p>We use a uniform distribution between -10 and 10 because of our lack of prior knowledge
on the diversification rate.
This actually means that we allow speciation and extinction rates
between $e^{-10}$ and $e^10$, so we should clearly cover the true values.
(Note that for diversification rate estimates, $e^{-10}$ is virtually 0
since the rate is so slow).</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>log_speciation_at_present ~ dnUniform(-10.0,10.0)
log_speciation_at_present.setValue(0.0)
log_extinction_at_present ~ dnUniform(-10.0,10.0)
log_extinction_at_present.setValue(-1.0)
</code></pre></div></div>

<p>We apply efficient sliding moves to each parameter.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>moves.append( mvScaleBactrian(log_speciation_at_present,weight=5))
moves.append( mvScaleBactrian(log_extinction_at_present,weight=5))
</code></pre></div></div>

<p>To make MCMC possible for the HSMRF model, we use what is called a non-centered parameterization.
This means that first we specify the log-scale changes in rate between intervals, and later we assemble these into the vector of rates, by adding them together and then exponentiating.
The HSMRF also requires a vector of local scale parameters.
These give the HSMRF a property called local adaptivity, which allow it to have rapidly varying rates in some intervals and nearly constant rates in others.
This can be done efficiently using a <code class="highlighter-rouge">for-loop</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for (i in 1:NUM_BREAKS) {
  sigma_speciation[i] ~ dnHalfCauchy(0,1)
  sigma_extinction[i] ~ dnHalfCauchy(0,1)

  # Make sure values initialize to something reasonable
  sigma_speciation[i].setValue(runif(1,0.005,0.1)[1])
  sigma_extinction[i].setValue(runif(1,0.005,0.1)[1])

  # non-centralized parameterization of horseshoe
  delta_log_speciation[i] ~ dnNormal( mean=0, sd=sigma_speciation[i]*speciation_global_scale*speciation_global_scale_hyperprior )
  delta_log_extinction[i] ~ dnNormal( mean=0, sd=sigma_extinction[i]*extinction_global_scale*extinction_global_scale_hyperprior )
}
</code></pre></div></div>

<p>Now, we take the pieces we have for the rates (the global and local scales, the rate at the present, and the log-changes) and we assemble the overall rates.
The <code class="highlighter-rouge">delta</code> parameters are differences in log-scale rates, and so we need to sum them then exponentiate.
For example, speciation[2] := exp(log_speciation_at_present + delta_log_speciation[1]).
Because the <code class="highlighter-rouge">sd</code> values for any of the log-scale differences is equivalent to what we wrote in the DAG above (simply written in expanded form), the model here is equivalent to the one in the DAG.
The function <code class="highlighter-rouge">fnassembleContinuousMRF()</code> does all the summation and exponentiation efficiently for all speciation and extinction rates in all intervals and avoids making the DAG too big.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>speciation := fnassembleContinuousMRF(log_speciation_at_present,delta_log_speciation,initialValueIsLogScale=TRUE,order=1)
extinction := fnassembleContinuousMRF(log_extinction_at_present,delta_log_extinction,initialValueIsLogScale=TRUE,order=1)
</code></pre></div></div>

<p>The HSMRF requires a unique set of MCMC samplers to work.
While you can place individual moves on the local and global scales and the log-changes, adequate MCMC sampling requires moves that exploit the structure of the model.
These moves are the elliptical slice sampler that works on the log-changes, a Gibbs sampler for the global and local scales, and a recommended swap move (that works on both).
But these moves require us to have the HSMRF model written out this way, and not the version we showed in the DAG.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># Move all field parameters in one go
moves.append( mvEllipticalSliceSamplingSimple(delta_log_speciation,weight=5,tune=FALSE) )
moves.append( mvEllipticalSliceSamplingSimple(delta_log_extinction,weight=5,tune=FALSE) )

# Move all field hyperparameters in one go
moves.append( mvHSRFHyperpriorsGibbs(speciation_global_scale, sigma_speciation , delta_log_speciation , speciation_global_scale_hyperprior, propGlobalOnly=0.75, weight=10) )
moves.append( mvHSRFHyperpriorsGibbs(extinction_global_scale, sigma_extinction , delta_log_extinction , extinction_global_scale_hyperprior, propGlobalOnly=0.75, weight=10) )

# Swap moves to exchange adjacent delta,sigma pairs
moves.append( mvHSRFIntervalSwap(delta_log_speciation ,sigma_speciation ,weight=5) )
moves.append( mvHSRFIntervalSwap(delta_log_extinction ,sigma_extinction ,weight=5) )
</code></pre></div></div>

<h4 class="subsubsection" id="setting-up-the-time-intervals">Setting up the time intervals</h4>
<hr class="subsubsection" />

<p>The model formulation we are using assumes that time points are evenly spaced.
We must now create this vector of times to give to the birth death model.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>interval_times &lt;- abs(T.rootAge() * seq(1, NUM_BREAKS, 1)/NUM_INTERVALS)
</code></pre></div></div>
<p>This vector of times will be used for both the speciation and extinction rates.
Also, remember that the times of the intervals represent ages going backwards in time.</p>

<h4 class="subsubsection" id="incomplete-taxon-sampling">Incomplete Taxon Sampling</h4>
<hr class="subsubsection" />

<p>We know that we have sampled 233 out of 367 living primate species.
To account for this we can set the sampling parameter as a constant node with a value of 233/367.
For simplicity, and since almost all species have been sampled,
we assume <em>uniform</em> taxon sampling <a class="citation" href="#Hoehna2011">(Höhna et al. 2011; Höhna 2014)</a>,</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rho &lt;- T.ntips()/367
</code></pre></div></div>

<h4 class="subsubsection" id="root-age">Root age</h4>
<hr class="subsubsection" />

<p>The birth-death process requires a parameter for the root age.
In this exercise we use a fixed tree and thus we know the age of the tree.
Hence, we can get the value for the root from the <a class="citation" href="#MagnusonFord2012">Magnuson-Ford and Otto (2012)</a> tree.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>root_time &lt;- T.rootAge()
</code></pre></div></div>

<h4 class="subsubsection" id="the-time-tree">The time tree</h4>
<hr class="subsubsection" />

<p>Now we have all of the parameters we need to specify the full episodic birth-death model.
We initialize the stochastic node representing the time tree.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>timetree ~ dnEpisodicBirthDeath(rootAge=T.rootAge(), lambdaRates=speciation, lambdaTimes=interval_times, muRates=extinction, muTimes=interval_times, rho=rho, samplingStrategy="uniform", condition="survival", taxa=taxa)
</code></pre></div></div>
<p>You may notice that we explicitly specify that we want to condition on survival.
It is possible to change this condition to the <em>time of the process</em> or
<em>the number of sampled taxa</em> too.</p>

<p>Then we attach data to the <code class="highlighter-rouge">timetree</code> variable.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>timetree.clamp(T)
</code></pre></div></div>

<p>Finally, we create a workspace object of our whole model using the <code class="highlighter-rouge">model()</code> function.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mymodel = model(speciation)
</code></pre></div></div>

<p>The <code class="highlighter-rouge">model()</code> function traversed all of the connections and found all of the nodes we specified.</p>

<h3 class="subsection" id="running-an-mcmc-analysis">Running an MCMC analysis</h3>
<hr class="subsection" />

<h4 class="subsubsection" id="specifying-monitors">Specifying Monitors</h4>
<hr class="subsubsection" />

<p>For our MCMC analysis, we need to set up a vector of <em>monitors</em> to record the states of our Markov chain.
First, we will initialize the model monitor using the <code class="highlighter-rouge">mnModel</code> function.
This creates a new monitor variable that will output the states for all model parameters
when passed into a MCMC function.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>monitors.append( mnModel(filename="output/primates_EBD.log",printgen=10, separator = TAB) )
</code></pre></div></div>

<p>Additionally, we create four separate file monitors, one for each vector of speciation and extinction rates and for each speciation and extinction rate epoch (\IE the times when the interval ends).
We want to have the speciation and extinction rates stored separately so that we can plot them nicely afterwards.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>monitors.append( mnFile(filename="output/primates_EBD_speciation s.log",printgen=10, separator = TAB, speciation) )
monitors.append( mnFile(filename="output/primates_EBD_speciation_times.log",printgen=10, separator = TAB, interval_times) )
monitors.append( mnFile(filename="output/primates_EBD_extinction s.log",printgen=10, separator = TAB, extinction) )
monitors.append( mnFile(filename="output/primates_EBD_extinction_times.log",printgen=10, separator = TAB, interval_times) )
</code></pre></div></div>

<p>Finally, we create a screen monitor that will report the states of specified variables
to the screen with <code class="highlighter-rouge">mnScreen</code>:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>monitors.append( mnScreen(printgen=1000, extinction_global_scale, speciation_global_scale) )
</code></pre></div></div>

<h4 class="subsubsection" id="initializing-and-running-the-mcmc-simulation">Initializing and Running the MCMC Simulation</h4>
<hr class="subsubsection" />

<p>With a fully specified model, a set of monitors, and a set of moves,
we can now set up the MCMC algorithm that will sample parameter values in proportion
to their posterior probability.
The <code class="highlighter-rouge">mcmc()</code> function will create our MCMC object:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mymcmc = mcmc(mymodel, monitors, moves, nruns=2, combine="mixed")
</code></pre></div></div>

<p>Now, run the MCMC:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mymcmc.run(generations=50000, tuningInterval=200)
</code></pre></div></div>

<p>When the analysis is complete, you will have the monitored files in your output directory.
You can then visualize the rates through time using <code class="highlighter-rouge">R</code> using our package <code class="highlighter-rouge">RevGadgets</code>.
If you don’t have the R-package <code class="highlighter-rouge">RevGadgets</code> installed, or if you have trouble with the package, then please read the separate tutorial about the package.</p>

<p>Just start <code class="highlighter-rouge">R</code> in the main directory for this analysis and then type the following commands:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">RevGadgets</span><span class="p">)</span><span class="w">

</span><span class="n">tree</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read.nexus</span><span class="p">(</span><span class="s2">"data/primates_tree.nex"</span><span class="p">)</span><span class="w">

</span><span class="n">rev_out</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rev.process.div.rates</span><span class="p">(</span><span class="n">speciation_times_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"output/primates_EBD_speciation_times.log"</span><span class="p">,</span><span class="w"> </span><span class="n">speciation</span><span class="w"> </span><span class="n">s_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"output/primates_EBD_speciation s.log"</span><span class="p">,</span><span class="w"> </span><span class="n">extinction_times_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"output/primates_EBD_extinction_times.log"</span><span class="p">,</span><span class="w"> </span><span class="n">extinction</span><span class="w"> </span><span class="n">s_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"output/primates_EBD_extinction s.log"</span><span class="p">,</span><span class="w"> </span><span class="n">tree</span><span class="o">=</span><span class="n">tree</span><span class="p">,</span><span class="w"> </span><span class="n">burnin</span><span class="o">=</span><span class="m">0.25</span><span class="p">,</span><span class="n">numIntervals</span><span class="o">=</span><span class="m">100</span><span class="p">)</span><span class="w">

</span><span class="n">pdf</span><span class="p">(</span><span class="s2">"EBD.pdf"</span><span class="p">)</span><span class="w">
</span><span class="n">par</span><span class="p">(</span><span class="n">mfrow</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">))</span><span class="w">
</span><span class="n">rev.plot.div.rates</span><span class="p">(</span><span class="n">rev_out</span><span class="p">,</span><span class="n">use.geoscale</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">dev.off</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>(Note, you may want to add a nice geological timescale to the plot by setting <code class="highlighter-rouge">use.geoscale=TRUE</code> but then you can only plot one figure per page.)</p>

<p>⇨ The <code class="highlighter-rouge">Rev</code> file for performing this analysis: <code class="highlighter-rouge">mcmc_EBD.Rev</code></p>

<figure id="fig_EBD_Results"><p><img src="figures/EBD_10_Result.png" width="75%" height="75%" /></p>
<figcaption>Resulting diversification rate estimations when using 10 intervals.
You should obtain similar results when you use 10 intervals.
The estimated rates might change when you use a different resolution, <em>i.e.,</em> a different number of intervals.</figcaption>
</figure>

<h3 class="subsection" id="exercise-1">Exercise 1</h3>
<hr class="subsection" />

<ul>
  <li>Run an MCMC simulation to estimate the posterior distribution of the speciation rate and extinction rate.</li>
  <li>Visualize the rate through time using <code class="highlighter-rouge">R</code>.</li>
  <li>Do you see evidence for rate decreases or increases? What is the general trend?</li>
  <li>How much faster is the <code class="highlighter-rouge">net-diversification</code> rate at the present compared to the most ancient time interval?</li>
  <li>Is there evidence for rate variation? Look at the estimates of <code class="highlighter-rouge">speciation_global_scale</code> and <code class="highlighter-rouge">extinction_global_scale</code> in <code class="highlighter-rouge">Tracer</code>: Is there information in the data to change the estimates from the prior?</li>
  <li>Run the analysis using a different number of intervals, <em>e.g.,</em> 100 or 200. How do the rates change?</li>
</ul>

<h3 class="subsection" id="exercise-2">Exercise 2</h3>
<hr class="subsection" />

<ul>
  <li>In our results we see that the extinction rate is fairly constant. Modify the model by using a constant-rate for the extinction rate parameter but still let the speciation rate vary through time.
    <ol>
      <li>Remove all previous occurrences of the extinction rates (<em>i.e.,</em> priors, parameters and moves).</li>
      <li>Specify a lognormal prior distribution on the constant extinction rate (<code class="highlighter-rouge">extinction ~ dnLognormal(-5,sd=2*0.587405)</code>)</li>
      <li>Add a move for the new extinction rate parameter <code class="highlighter-rouge">moves.append( mvScaleBactrian(extinction,weight=5.0) )</code>.</li>
      <li>Remove the argument <code class="highlighter-rouge">muTimes=interval_times</code> from the birth-death process.</li>
    </ol>
  </li>
  <li>How does this influence your estimated rates?</li>
</ul>


<ol class="bibliography"><li><span id="Carvalho2010">Carvalho C.M., Polson N.G., Scott J.G. 2010. The horseshoe estimator for sparse signals. Biometrika. 97:465–480.</span>

</li>
<li><span id="Hoehna2014a">Höhna S. 2014. Likelihood Inference of Non-Constant Diversification Rates with Incomplete Taxon Sampling. PLoS One. 9:e84184.</span>

<a href="https://doi.org/10.1371/journal.pone.0084184">10.1371/journal.pone.0084184</a>

</li>
<li><span id="Hoehna2015a">Höhna S. 2015. The time-dependent reconstructed evolutionary process with a key-role for mass-extinction events. Journal of Theoretical Biology. 380:321–331.</span>

<a href="https://doi.org/http://dx.doi.org/10.1016/j.jtbi.2015.06.005">http://dx.doi.org/10.1016/j.jtbi.2015.06.005</a>

</li>
<li><span id="Hoehna2014b">Höhna S., Heath T.A., Boussau B., Landis M.J., Ronquist F., Huelsenbeck J.P. 2014. Probabilistic Graphical Model Representation in Phylogenetics. Systematic Biology. 63:753–771.</span>

<a href="https://doi.org/10.1093/sysbio/syu039">10.1093/sysbio/syu039</a>

</li>
<li><span id="Hoehna2011">Höhna S., Stadler T., Ronquist F., Britton T. 2011. Inferring speciation and extinction rates under different species sampling schemes. Molecular Biology and Evolution. 28:2577–2589.</span>

</li>
<li><span id="Magee2020">Magee A.F., Höhna S., Vasylyeva T.I., Leaché A.D., Minin V.N. 2020. Locally adaptive Bayesian birth-death model successfully detects slow and rapid rate shifts. PLoS Computational Biology. 16:e1007999.</span>

</li>
<li><span id="MagnusonFord2012">Magnuson-Ford K., Otto S.P. 2012. Linking the Investigations of Character Evolution and Species Diversification. The American Naturalist. 180:225–245.</span>

<a href="https://doi.org/10.1086/666649">10.1086/666649</a>

</li>
<li><span id="Stadler2011">Stadler T. 2011. Mammalian phylogeny reveals recent diversification rate shifts. Proceedings of the National Academy of Sciences. 108:6187–6192.</span>

<a href="https://doi.org/10.1073/pnas.1016876108">10.1073/pnas.1016876108</a>

</li></ol>

<script type="text/javascript">
var _ol = document.querySelectorAll('ol');
for (var i = 0, elem_ol; elem_ol = _ol[i]; i++) {
	if ( elem_ol.classList == "bibliography" ) {
		var _li = elem_ol.getElementsByTagName("li");
		//for (var j = 0, elem_li; elem_li = _li[j]; j++)
		//{
		//	elem_li.innerHTML = elem_li.innerHTML.replace(/(https?:\/\/)([^\s<]+)/,"<a href=\"$1$2\">$2");
		//}
		if(_li.length > 0)
			elem_ol.outerHTML = "<h2 class='references'>References</h2><hr class='references'>"+elem_ol.outerHTML
	}
}
</script>

      <br>
<footer>
  <div class="container">
  <div class="row">
    <div class="col-sm-12" align="center">
      <a href="https://github.com/revbayes">GitHub</a> | <a href="/license">License</a> | <a href="/citation">Citation</a> | <a href="https://groups.google.com/forum/#!forum/revbayes-users">Users Forum</a>
    </div>
  </div>
  <br>
  </div>
</footer>

    </div>
    <script src="/assets/js/vendor/jquery.min.js"></script>
<script src="/assets/js/vendor/FileSaver.min.js"></script>
<script src="/assets/js/vendor/jszip.min.js"></script>
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<script type="text/javascript">
// Add default language
$(":not(code).highlighter-rouge").each(function() {
  
  if( this.classList == "highlighter-rouge") {
    this.classList = "Rev highlighter-rouge";
  }
  
});
// $("code.highlighter-rouge").each(function() {
//   
//   if( this.classList == "highlighter-rouge") {
//       this.classList = "Rev highlighter-rouge";
//   }
//   
// });
</script>
<script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
    });
    MathJax.Hub.Queue(function () {
      $(".aside").each(function() {
          $("div .MathJax", this).hide();
      });
    });
</script>
<script src="/assets/js/base.js"></script>

  </body>
</html>
