<!doctype html>
<html lang="en">
<link rel="icon" type="image/png" href="/assets/img/favicon.png" >
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="search-domain" value="https://revbayes.github.io/">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <title>RevBayes: Branch-Specific Diversification Rate Estimation</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <a href="/" class="pull-left">
        
        <img class="navbar-logo" src="/assets/img/aquabayes-desaturated.png" alt="RevBayes Home" />
        
      </a>

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar" align="right"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="/download">Download</a></li>
        <li><a href="/tutorials/">Tutorials</a></li>
        <li><a href="/documentation/">Documentation</a></li>
        <li><a href="/interfaces">Interfaces</a></li>
        <li><a href="/workshops/">Workshops</a></li>
        <li><a href="/jobs/">Jobs</a></li>
        <li><a href="/developer/">Developer</a></li>
      </ul>
      <!-- <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form> -->
    </div>
  </div>
</nav>

      <div class="titlebar">
	<h1 class="maintitle">Branch-Specific Diversification Rate Estimation</h1>
	<h3 class="subtitle">How to estimate branch-specific shifts in diversification rates</h3>
	<h4 class="authors">Sebastian Höhna and Michael R. May</h4>
  <h5>Last modified on March 11, 2022</h5>
</div>


<div class="sidebar no-print">
<blockquote class="overview" id="overview">
  <h2>Overview</h2>
  
  <div class="row">
    <div class="col-md-9">
        <strong>Prerequisites</strong>
        
          <ul id="prerequisites">
          
            <li><a href="/tutorials/intro/">Getting Started with RevBayes and Rev Language Syntax</a></li>
          
            <li><a href="/tutorials/mcmc/">Introduction to Markov chain Monte Carlo (MCMC) Sampling</a></li>
          
            <li><a href="/tutorials/divrate/simple.html">Simple Diversification Rate Estimation</a></li>
          
          </ul>
        
    </div>
  </div>
  
</blockquote>





<blockquote class="tutorial_files" id="tutorial_files">
    <h2>Data files and scripts</h2>
    
        
        <strong>Data Files</strong>
        <ul id="data_files">
        
        
        
          <li><a href="/tutorials/morph_ase/data/primates_tree.nex">primates_tree.nex</a></li>
        
          <li><a href="/tutorials/biogeo/data/primates_tree.nex">primates_tree.nex</a></li>
        
          <li><a href="/tutorials/divrate/data/primates_tree.nex">primates_tree.nex</a></li>
        
        </ul>
    
        
        <strong>Scripts</strong>
        <ul id="scripts">
        
        
        
          <li><a href="/tutorials/divrate/scripts/mcmc_BDS.Rev">mcmc_BDS.Rev</a></li>
        
          <li><a href="/tutorials/divrate/scripts/plot_BDS.R">plot_BDS.R</a></li>
        
        </ul>
    
        
        <strong>Other</strong>
        <ul id="other_files">
        
        
        
          <li><a href="/tutorials/intro/data/primates_tree.nex">primates_tree.nex</a></li>
        
          <li><a href="/tutorials/cont_traits/data/primates_tree.nex">primates_tree.nex</a></li>
        
          <li><a href="/tutorials/sse/data/primates_tree.nex">primates_tree.nex</a></li>
        
        </ul>
    
</blockquote>


</div>
<h2 class="section" id="outline58-estimating-branch-specific-speciation--extinction-rates">Outline: Estimating Branch-Specific Speciation &amp; Extinction Rates</h2>
<hr class="section" />

<p>This tutorial describes how to specify a branch-specific
branching-process models in RevBayes; a birth-death process where
diversification rates vary among branches, similar to <a class="citation" href="#Rabosky2014a">Rabosky (2014)</a>.
The probabilistic graphical model is given for each component of this
tutorial. The goal is to obtain estimate of branch-specific
diversification rates using Markov chain Monte Carlo (MCMC).</p>

<h3 class="subsection" id="the-birth-death-shift-process">The Birth-Death-Shift Process</h3>
<hr class="subsection" />

<figure id="fig_augmented"><p><img src="figures/augmented.png" width="800" /></p>
<figcaption>An example of a tree with a single event of diversification rate change, from
$(\lambda_1, \mu_1)$ to $(\lambda_2, \mu_2)$. a) A tree showing the complete cladogenetic process, including
extinct lineages. b) The reconstructed process for the tree shown in <em>a</em>.</figcaption>
</figure>

<p><a href="#fig_augmented"></a> shows an example in which speciation and extinction rates change among lineages.
The speciation and extinction rates at the root of the tree of <a href="#fig_augmented"></a> are $(\lambda_1, \mu_1)$. 
There was one event of change to the speciation and extinction rates on the 
tree from $(\lambda_1, \mu_1)$ to $(\lambda_2, \mu_2)$.
From a casual inspection of the tree, it appears that the single change in speciation and/or extinction rate
in the tree of <a href="#fig_augmented"></a> affected the diversity. Note that the clade above the event of speciation/extinction
rate change has fewer living species, and more extinct species, than the clade that maintained the ancestral
speciation and extinction rates.
This is exactly the type of situation we attempt to uncover.</p>

<p>Here we will describe the birth-death-shift process.
The parameters in this model are:</p>

<ul>
  <li>$\lambda_i$: the rates of speciation of the $i^{\text{th}}$ lineage</li>
  <li>$\mu_i$: the rates of extinction of the $i^{\text{th}}$ lineage</li>
  <li>$\eta$: the rate at which speciation/extinction rates change</li>
</ul>

<p>The process is described as follows. In a small interval of time, $\Delta t$, a lineage 
speciates with probability $\lambda \Delta t$, goes extinct with probability $\mu \Delta t$, 
or changes its rate with probability $\eta \Delta t$. 
When a speciation event occurs, both daughter lineages inherit the speciation and extinction rates of the parent
lineage. When an event of rate change occurs, new speciation and extinction rates are drawn from
the probability distributions, $f_{\lambda}(\cdot)$ and $f_{\mu}(\cdot)$. 
The affected lineage then continues, but with the modified speciation and extinction rates. 
When an extinction event occurs, the lineage is terminated at the event time.</p>

<figure id="fig_conditioning"><p><img src="figures/conditioning.png" width="800" /></p>
<figcaption>Samples of an MCMC analysis under a <em>Birth-Death-Shift</em> model. The colors
represent different classes of rates for the speciation and extinction rates ($\lambda$ and
$\mu$, respectively. Note that the speciation and extinction rates at the root of the tree
differ for the different MCMC samples: $(\lambda’,\mu’)$, $(\lambda’’,\mu’’)$, 
and $(\lambda’’’,\mu’’’)$.</figcaption>
</figure>

<h2 class="section" id="estimating-branch-specific-diversification-rates">Estimating Branch-Specific Diversification Rates</h2>
<hr class="section" />

<p>In this analysis we are interested in estimating the branch-specific diversification rates.
We show how to implement and use the model developed by <a class="citation" href="#Hoehna2019">Höhna et al. (2019)</a>
We are going to use the <code class="language-plaintext highlighter-rouge">dnCBDP</code> distribution which uses a finite number of rate-categories
instead of drawing rates from a continuous distribution directly.</p>

<p>Here we adopt an approach using (few) discrete rate categories.
This allows us to numerically integrate over all possible rate categories using
a system of differential equations originally described by <a class="citation" href="#Maddison2007">Maddison et al. (2007)</a>
(see also <a class="citation" href="#FitzJohn2009">FitzJohn et al. (2009)</a> and <a class="citation" href="#FitzJohn2010">FitzJohn (2010)</a>).
The numerical procedure breaks time into very small time intervals and sums
over all possible events occurring in that interval (see <a href="#fig_likelihood"></a>).</p>

<figure id="fig_likelihood"><p><img src="figures/likelihood.png" width="100%" height="100%" /></p>
<figcaption><strong>Possible scenarios that could occur over the interval $\Delta t$ along a lineage that is observed at time $t$.</strong>
To compute the probability under the birth-death-shift process, we traverse the tree from the tips to the root in small time steps, $\Delta t$.
For each step into the past, from time $t$ to time ($t+\Delta t$), we compute the change in probability of the observed lineage by enumerating all of the possible scenarios that could occur over the interval $\Delta t$:
    (<em>i</em>) nothing happens,
    (<em>ii</em>) a speciation event occurs, where the right descendant survives and the left descendant goes extinct before the present, or
    (<em>iii</em>) a speciation event occurs, where the left descendant survives but the right goes extinct before the present, or
    (<em>iv</em>) a diversification-rate shift from category $i$ to $j$ occurs.
Color key: segment(s) of the tree within the interval $\Delta t$ are colored blue for state $i$ and/or green for state $j$ to reflect the conditioning of the corresponding scenarios,
segment(s) of the tree between $t$ and the present are colored gray because we have integrated over the $k$ discrete rate categories (no specific assignment of rate categories), and
segments of the tree between $t+\Delta t$ and the root are colored gray because we will integrated over the $k$ discrete rate categories.</figcaption>
</figure>

<p>You don’t need to worry about any of the technical details.
It is important for you to realize that this model assumes that new rates at a
rate-shift event are drawn from a given (discrete) set of rates (see <a href="#fig_discretized_lognormal"></a>).</p>

<h3 class="subsection" id="read-the-tree">Read the tree</h3>
<hr class="subsection" />

<p>Begin by reading in the observed tree.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>observed_phylogeny &lt;- readTrees("data/primates_tree.nex")[1]
</code></pre></div></div>
<p>From this tree, we can get some helpful variables:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>taxa &lt;- observed_phylogeny.taxa()
root &lt;- observed_phylogeny.rootAge()
tree_length &lt;- observed_phylogeny.treeLength()
</code></pre></div></div>
<p>Additionally, we initialize a variable for our vector of moves and monitors.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>moves    = VectorMoves()
monitors = VectorMonitors()
</code></pre></div></div>
<p>Finally, we create a helper variable that specifies the number of
discrete rate categories, another helper variable for the total number of species
and our constant for specifying the standard deviation of the lognormal distribution.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NUM_RATE_CATEGORIES = 6
NUM_TOTAL_SPECIES = 367
H = 0.587405
</code></pre></div></div>
<p>Using these variables we can easily change our script, for example,
to use more or fewer categories and test the impact.</p>

<h3 class="subsection" id="specifying-the-model">Specifying the model</h3>
<hr class="subsection" />

<h4 class="subsubsection" id="priors-on-rates">Priors on rates</h4>
<hr class="subsubsection" />

<figure id="fig_discretized_lognormal"><p><img src="figures/discretized_distributions.png" width="100%" height="100%" /></p>
<figcaption><strong>Approximation of the continuous base distributions for the diversification-rate parameters using discrete rate categories.</strong>
From left to right, we show a discretization of a lognormal distribution with k={2,4,6,8,10,20} bins.
Our approach for computing the probability of the data under the lineage-specific birth-death-shift
model specifies <em>k</em> quantiles of the continuous base distributions for the speciation and extinction rates.
We compute probabilities by marginalizing (averaging) over the <em>k</em> discrete rate categories,
where the diversification rate for a given category is the median of the corresponding quantile (colored dots).
This approach provides an efficient alternative to computing the continuous integral,
and will provide a reliable approximation of the continuous integral when the number of categories <em>k</em> is sufficiently large to resemble the underlying continuous distribution.</figcaption>
</figure>

<p>Instead of using a continuous probability distribution we will use a
discrete approximation of the distribution, as done for modeling rate
variation across sites <a class="citation" href="#Yang1994a">(Yang 1994)</a> and for modeling relaxed molecular
clocks <a class="citation" href="#Drummond2006">(Drummond et al. 2006)</a>. That means, we assume that the speciation rates
are drawn from one of the $N$ quantiles of the lognormal distribution.
For this we will use the function <code class="language-plaintext highlighter-rouge">fnDiscretizeDistribution</code> which takes
in a distribution as its first argument and the number of quantiles as
the second argument. The return value is a vector of quantiles. We use
it as a deterministic variable and every time the parameters of the base
distribution (i.e., the lognormal
distribution in our case) change the quantiles will update automatically
as well. Thus we only need to specify parameters for our base
distribution, the lognormal distribution.
We choose a log-uniform distribution as the prior distribution for the mean parameter of the lognormal distribution.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>speciation_mean ~ dnLoguniform( 1E-6, 1E2)
moves.append( mvScale(speciation_mean, lambda=1, tune=true, weight=2.0) )
</code></pre></div></div>
<p>Next, we choose an exponential prior distribution with mean of $H$ for the variation in speciation rates.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>speciation_sd ~ dnExponential( 1.0 / H )
moves.append( mvScale(speciation_sd, lambda=1, tune=true, weight=2.0) )
</code></pre></div></div>
<p>Now, we can compute the speciation rate categories.
We will use a lognormal distribution discretized into <code class="language-plaintext highlighter-rouge">NUM_RATE_CATEGORIES</code> quantiles and the parameters that we should created.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>speciation := fnDiscretizeDistribution( dnLognormal(ln(speciation_mean), speciation_sd), NUM_RATE_CATEGORIES )
</code></pre></div></div>

<!-- Alternatively, we choose a fixed standard deviation of $H * 2$ for the
speciation rates because it represents two orders of magnitude variance
in the rate categories.
```
speciation_sd <- H*2
speciation := fnDiscretizeDistribution( dnLognormal(ln(speciation_mean), speciation_sd), NUM_RATE_CATEGORIES )
```
-->
<p>Similarly, we define the prior on the extinction rate in the same way as we did for
the speciation rate.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extinction_mean ~ dnLoguniform( 1E-6, 1E2)
extinction_mean.setValue( speciation_mean / 2.0 )
moves.append( mvScale(extinction_mean, lambda=1, tune=true, weight=2.0) )
</code></pre></div></div>
<p>However, we assume that extinction rate is the same for all categories.
Therefore, we simply replicate using the <code class="language-plaintext highlighter-rouge">rep</code> function the extinction rate <code class="language-plaintext highlighter-rouge">NUM_RATE_CATEGORIES</code> times.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extinction := rep( extinction_mean, NUM_RATE_CATEGORIES )
</code></pre></div></div>
<p>Next, we need a rate parameter for the rate-shifts events. We do not
have much prior information about this rate but we can provide some
realistic ranges. For example, we can specify a uniform distribution that the
goes from 0 to 100 expected events.
Remember that this is only possible if the tree is known and not
estimated simultaneously because only if the tree is known, then we also know the
tree length. As usual for rate parameter, we apply a scaling move to the
<code class="language-plaintext highlighter-rouge">event_rate</code> variable.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>event_rate ~ dnUniform(0.0, 100.0/tree_length)
moves.append( mvScale(event_rate, lambda=1, tune=true, weight=2.0) )
</code></pre></div></div>
<p>Additionally, we need a parameter for probability that the process starts at the root in any of the diversification-rate categories.
We use a uniform/equal prior distribution on the diversification-rate categories.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rate_cat_probs &lt;- simplex( rep(1, NUM_RATE_CATEGORIES) )
</code></pre></div></div>

<blockquote class="aside"><h2>Shifts in the Extinction Rate</h2><p>We might want to allow the extinction rate to change as well.
As with the speciation rate, we discretize the lognormal distribution
into a finite number of rate categories.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>extinction_categories := fnDiscretizeDistribution( dnLognormal(ln(extinction_mean), H), NUM_RATE_CATEGORIES )
</code></pre></div></div>
<p>Now, we must create a vector that contains each combination of
speciation- and extinction-rates. This allows the rate of speciation to
change without changing the rate of extinction and vice versa. The
resulting vector should be $N^2$ elements long. We call these the
`paired’ rate categories.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>k = 1
for(i in 1:NUM_RATE_CATEGORIES) {
    for(j in 1:NUM_RATE_CATEGORIES) {
        speciation[k]   := speciation_categories[i]
        extinction[k++] := extinction_categories[j]
    }
}
</code></pre></div></div>
<p>Now we also need to specify a root prior for $N^2$ elements.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rate_cat_probs &lt;- simplex( rep(1, NUM_RATE_CATEGORIES * NUM_RATE_CATEGORIES) )

</code></pre></div></div>
<p>Note however, that this type of analysis will take significantly longer to run!</p>
</blockquote>

<h4 class="subsubsection" id="incomplete-taxon-sampling">Incomplete Taxon Sampling</h4>
<hr class="subsubsection" />

<p>We know that we have sampled 233 out of 367 living primate species. To
account for this we can set the sampling parameter as a constant node
with a value of 233 / 367.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rho &lt;- observed_phylogeny.ntips() / NUM_TOTAL_SPECIES
</code></pre></div></div>

<h4 class="subsubsection" id="root-age">Root age</h4>
<hr class="subsubsection" />

<p>The birth-death process requires a parameter for the root age. In this
exercise we use a fix tree and thus we know the age of the tree. Hence,
we can get the value for the root from the <a class="citation" href="#MagnusonFord2012">(Magnuson-Ford and Otto 2012)</a> tree. This
is done using our global variable <code class="language-plaintext highlighter-rouge">root</code> defined above and nothing else
has to be done here.</p>

<h4 class="subsubsection" id="the-time-tree">The time tree</h4>
<hr class="subsubsection" />

<p>Now we have all of the parameters we need to specify the full
branch-specific birth-death model. We initialize the stochastic node
representing the time tree.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>timetree ~ dnCDBDP( rootAge           = root,
                    speciationRates   = speciation,
                    extinctionRates   = extinction,
                    Q                 = fnJC(NUM_RATE_CATEGORIES),
                    delta             = event_rate,
                    pi                = rate_cat_probs,
                    rho               = rho,
                    condition         = "time" )
</code></pre></div></div>
<p>And then we attach data to it.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>timetree.clamp(observed_phylogeny)
</code></pre></div></div>

<p>Finally, we create a workspace object of our whole model using the
<code class="language-plaintext highlighter-rouge">model()</code> function.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mymodel = model(speciation)
</code></pre></div></div>
<p>The <code class="language-plaintext highlighter-rouge">model()</code> function traversed all of the connections and found all of
the nodes we specified.</p>

<h3 class="subsection" id="running-an-mcmc-analysis">Running an MCMC analysis</h3>
<hr class="subsection" />

<h4 class="subsubsection" id="specifying-monitors">Specifying Monitors</h4>
<hr class="subsubsection" />

<p>For our MCMC analysis, we need to set up a vector of <em>monitors</em> to
record the states of our Markov chain. First, we will initialize the
model monitor using the <code class="language-plaintext highlighter-rouge">mnModel</code> function. This creates a new monitor
variable that will output the states for all model parameters when
passed into a MCMC function.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>monitors.append( mnModel(filename="output/primates_BDS.log",printgen=1, separator = TAB) )
</code></pre></div></div>
<p>For summary and plotting purposes, we need to obtain the branch-specific diversification rate estimate along the tree.
We will use a stochastic rate mapping algorithm <a class="citation" href="#Freyman2019">Freyman and Höhna (2019)</a>.
Thus, we create an <code class="language-plaintext highlighter-rouge">mnStochasticBranchRate</code>. The stochastic branch-rate monitor
draws stochastic character maps and writes the <em>simulated</em> branch rates into a file.
We will need this file later to estimate and visualize the posterior
distribution of the rates at the branches.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>monitors.append( mnStochasticBranchRate(cdbdp=timetree, printgen=1, filename="output/primates_BDS_rates.log") )
</code></pre></div></div>
<p>Finally, create a screen monitor that will report the states of
specified variables to the screen with <code class="language-plaintext highlighter-rouge">mnScreen</code>:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>monitors.append( mnScreen(printgen=10, event_rate, speciation_mean, extinction_mean) )
</code></pre></div></div>

<h4 class="subsubsection" id="initializing-and-running-the-mcmc-simulation">Initializing and Running the MCMC Simulation</h4>
<hr class="subsubsection" />

<p>With a fully specified model, a set of monitors, and a set of moves, we
can now set up the MCMC algorithm that will sample parameter values in
proportion to their posterior probability. The <code class="language-plaintext highlighter-rouge">mcmc()</code> function will
create our MCMC object:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mymcmc = mcmc(mymodel, monitors, moves, nruns=2, combine="mixed")
</code></pre></div></div>
<p>Now, run the MCMC:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mymcmc.run(generations=2500,tuning=200)
</code></pre></div></div>

<p>⇨ The <code class="language-plaintext highlighter-rouge">Rev</code> file for performing this analysis: <code class="language-plaintext highlighter-rouge">mcmc_BDS.Rev</code></p>

<p>When the analysis is complete, you will have the monitored files in your
output directory. You can then visualize the branch-specific rates by
plotting them using our <code class="language-plaintext highlighter-rouge">R</code> package <code class="language-plaintext highlighter-rouge">RevGadgets</code>.</p>

<p>Just start <code class="language-plaintext highlighter-rouge">R</code> in the main directory for this analysis and then type the following commands:</p>
<div class="language-R highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">RevGadgets</span><span class="p">)</span><span class="w">

</span><span class="n">my_tree_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"data/primates_tree.nex"</span><span class="w">
</span><span class="n">my_branch_rates_file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"output/primates_BDS_rates.log"</span><span class="w">
</span><span class="n">tree_plot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plot_branch_rates_tree</span><span class="p">(</span><span class="w"> </span><span class="n">tree_file</span><span class="o">=</span><span class="n">my_tree_file</span><span class="p">,</span><span class="w">
                                    </span><span class="n">branch_rates_file</span><span class="o">=</span><span class="n">my_branch_rates_file</span><span class="p">)</span><span class="w">

</span><span class="n">ggsave</span><span class="p">(</span><span class="s2">"BDS.pdf"</span><span class="p">,</span><span class="w"> </span><span class="n">width</span><span class="o">=</span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">height</span><span class="o">=</span><span class="m">15</span><span class="p">,</span><span class="w"> </span><span class="n">units</span><span class="o">=</span><span class="s2">"cm"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<figure id="fig_BDS"><p><img src="figures/BDS.png" width="100%" height="100%" /></p>
<figcaption><strong>Estimated branch-specific speciation rates.</strong>
Here we show the results of our example analysis. You’ll see that there is a speciation rate
increase for the New World Monkeys.</figcaption>
</figure>

<h3 class="subsection" id="exercise-1">Exercise 1</h3>
<hr class="subsection" />

<ul>
  <li>Run an MCMC simulation to estimate the posterior distribution of the speciation rate and extinction rate.</li>
  <li>Visualize the branch-specific rates in <code class="language-plaintext highlighter-rouge">R</code> using <code class="language-plaintext highlighter-rouge">RevGadgets</code>.</li>
  <li>Do you see evidence for rate decreases or increases? What is the general trend?</li>
  <li>Run the analysis using a different number of rate categories (<code class="language-plaintext highlighter-rouge">NUM_RATE_CATEGORIES</code>), <em>e.g.,</em> 4 or 10. How do the rates change?</li>
</ul>


<ol class="bibliography"><li><span id="Drummond2006">Drummond A.J., Ho S.Y.W., Phillips M.J., Rambaut A. 2006. Relaxed Phylogenetics and Dating with Confidence. PLoS Biology. 4:e88.</span>

<a href="https://doi.org/10.1371/journal.pbio.0040088">10.1371/journal.pbio.0040088</a>

</li>
<li><span id="FitzJohn2009">FitzJohn R.G., Maddison W.P., Otto S.P. 2009. Estimating trait-dependent speciation and extinction rates from incompletely resolved phylogenies. Systematic Biology. 58:595–611.</span>

<a href="https://doi.org/10.1093/sysbio/syp067">10.1093/sysbio/syp067</a>

</li>
<li><span id="FitzJohn2010">FitzJohn R.G. 2010. Quantitative Traits and Diversification. Systematic Biology. 59:619–633.</span>

<a href="https://doi.org/10.1093/sysbio/syq053">10.1093/sysbio/syq053</a>

</li>
<li><span id="Freyman2019">Freyman W.A., Höhna S. 2019. Stochastic character mapping of state-dependent diversification reveals the tempo of evolutionary decline in self-compatible Onagraceae lineages. Systematic Biology. 68:505–519.</span>

</li>
<li><span id="Hoehna2019">Höhna S., Freyman W.A., Nolen Z., Huelsenbeck J.P., May M.R., Moore B.R. 2019. A Bayesian Approach for Estimating Branch-Specific Speciation and Extinction Rates. bioRxiv.</span>

<a href="https://doi.org/10.1101/555805">10.1101/555805</a>

</li>
<li><span id="Maddison2007">Maddison W.P., Midford P.E., Otto S.P. 2007. Estimating a binary character’s effect on speciation and extinction. Systematic Biology. 56:701.</span>

<a href="https://doi.org/10.1080/10635150701607033">10.1080/10635150701607033</a>

</li>
<li><span id="MagnusonFord2012">Magnuson-Ford K., Otto S.P. 2012. Linking the Investigations of Character Evolution and Species Diversification. The American Naturalist. 180:225–245.</span>

<a href="https://doi.org/10.1086/666649">10.1086/666649</a>

</li>
<li><span id="Rabosky2014a">Rabosky D.L. 2014. Automatic detection of key innovations, rate shifts, and diversity-dependence on phylogenetic trees. PLoS One. 9:e89543.</span>

<a href="https://doi.org/10.1371/journal.pone.0089543">10.1371/journal.pone.0089543</a>

</li>
<li><span id="Yang1994a">Yang Z. 1994. Maximum Likelihood Phylogenetic Estimation from DNA Sequences with Variable Rates Over Sites: Approximate Methods. Journal of Molecular Evolution. 39:306–314.</span>

<a href="https://doi.org/10.1007/BF00160154">10.1007/BF00160154</a>

</li></ol>

<script type="text/javascript">
var _ol = document.querySelectorAll('ol');
for (var i = 0, elem_ol; elem_ol = _ol[i]; i++) {
	if ( elem_ol.classList == "bibliography" ) {
		var _li = elem_ol.getElementsByTagName("li");
		//for (var j = 0, elem_li; elem_li = _li[j]; j++)
		//{
		//	elem_li.innerHTML = elem_li.innerHTML.replace(/(https?:\/\/)([^\s<]+)/,"<a href=\"$1$2\">$2");
		//}
		if(_li.length > 0)
			elem_ol.outerHTML = "<h2 class='references'>References</h2><hr class='references'>"+elem_ol.outerHTML
	}
}
</script>

      <br>
<footer>
  <div class="container">
  <div class="row">
    <div class="col-sm-12" align="center">
      <a href="https://github.com/revbayes">GitHub</a> | <a href="/license">License</a> | <a href="/citation">Citation</a> | <a href="https://groups.google.com/forum/#!forum/revbayes-users">Users Forum</a>
    </div>
  </div>
  <br>
  </div>
</footer>

    </div>
    <script src="/assets/js/vendor/jquery.min.js"></script>
<script src="/assets/js/vendor/FileSaver.min.js"></script>
<script src="/assets/js/vendor/jszip.min.js"></script>
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<script type="text/javascript">
// Add default language
$(":not(code).highlighter-rouge").each(function() {
  
  if( this.classList == "highlighter-rouge") {
    this.classList = "Rev highlighter-rouge";
  }
  
});
// $("code.highlighter-rouge").each(function() {
//   
//   if( this.classList == "highlighter-rouge") {
//       this.classList = "Rev highlighter-rouge";
//   }
//   
// });
</script>
<script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
    });
    MathJax.Hub.Queue(function () {
      $(".aside").each(function() {
          $("div .MathJax", this).hide();
      });
    });
</script>
<script src="/assets/js/base.js"></script>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0Y03X9Q2TJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0Y03X9Q2TJ');
</script>

  </body>
</html>
