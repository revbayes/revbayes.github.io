<!doctype html>
<html lang="en">
<link rel="icon" type="image/png" href="/revbayes-site/assets/img/favicon.png" >
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="search-domain" value="https://revbayes.github.io/revbayes-site/">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" href="/revbayes-site/assets/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/revbayes-site/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/revbayes-site/assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="/revbayes-site/assets/css/main.css" />
    <title>RevBayes: Getting Started with RevBayes</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default">
  <div class="container-fluid">
    <div class="navbar-header">
      <a href="/revbayes-site/" class="pull-left">
        
        <img class="navbar-logo" src="/revbayes-site/assets/img/aquabayes-desaturated.png" alt="RevBayes Home" />
        
      </a>
      
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar" align="right"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="/revbayes-site/software">Software</a></li>
        <li><a href="/revbayes-site/tutorials/">Tutorials</a></li>
        <li><a href="/revbayes-site/workshops/">Workshops</a></li>
        <li><a href="/revbayes-site/developer/">Developer</a></li>
      </ul>
      <!-- <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form> -->
    </div>
  </div>
</nav>

      <div class="titlebar">
	<h1 class="maintitle">Getting Started with RevBayes</h1>
	<h3 class="subtitle">A very basic overview on how to use RevBayes</h3>
	<h4 class="authors">Sebastian Höhna</h4>
</div>


<div class="sidebar no-print">
<blockquote class="overview" id="overview">
  <h2>Overview</h2>
  
  <div class="row">
    <div class="col-md-9">
        <strong>Prerequisites</strong>
        
          <ul>
          <li>None</li>
          </ul>
        
    </div>
  </div>
  
</blockquote>





</div>
<h1 id="overview">Overview</h1>

<p>RevBayes has as its central idea that any statistical model, for
example a phylogenetic model, is composed of smaller parts that can be
decomposed and put back together in a modular fashion <a href="#Hoehna2016b">(Höhna et al. 2016)</a>.
This comes from considering (phylogenetic) models as <em>probabilistic
graphical models</em>, which lends flexibility and enhances the capabilities
of the program. Users interact with RevBayes via an interactive shell.
Users communicate commands using a language specifically designed for
RevBayes, called <code class="highlighter-rouge">Rev</code>; an R-like language (complete with control
statements, user-defined functions, and loops) that enables the user to
build up (phylogenetic) models from simple parts (random variables,
variable/parameter transformations, models, and constants of different
sorts).</p>

<p>Here we assume that you have successfully installed RevBayes. If this
isn’t the case, then please consult our website on how to install
RevBayes.</p>

<h1 id="getting-started">Getting Started</h1>

<p>For the examples outlined in each tutorial, we will use RevBayes
interactively by typing commands in the command-line console. For the
exercises you can either use RevBayes interactively or run an entire
script. Execute the RevBayes binary. If this program is in your path,
then you can simply type in your Unix terminal:</p>

<ul>
  <li>’$ rb’\</li>
</ul>

<p>When you execute the program, you will see a brief program information,
including the current version number. Remember that more information can
be obtained from <a href="www.RevBayes.com">www.RevBayes.com</a>. When you execute
the program with an additional filename,
<em>e.g.,</em></p>

<ul>
  <li>’$ rb my_analysis.Rev’\</li>
</ul>

<p>then RevBayes will run all commands specified in your file.</p>

<p>You may want to run RevBayes in parallel using multiple processes.
This can be done by starting RevBayes with</p>

<ul>
  <li>’$ mpirun -np 4 rb-mpi’\</li>
</ul>

<p>which starts 4 processes of RevBayes. You may want to change the
number of processes depending on your available hardware.</p>

<p>The format of the exercises uses to delineate code examples that you
should type into RevBayes. For example, after opening the RevBayes
program, you can load your data file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>data &lt;- readDiscreteCharacterData("data/primates_cytb.nex")
</code></pre></div></div>

<p>The ‘RevBayes &gt;’ prompt that you see in your terminal is omitted so
that the examples can be copied and pasted wholly. This is especially
useful for larger command blocks, particularly loops, which will often
be displayed in boxes</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for( i in 1:12 ){
  x[i] ~ dnExponential(1.0)
}
</code></pre></div></div>

<p>The various RevBayes commands and syntax within the text are specified
using ‘typewriter text’.</p>

<p>Most tutorials also includes hyperlinks: bibliographic citations are and
link to the full citation in the references, external URLs are , and
internal references to figures and equations are .</p>

<p>The various exercises in this tutorial take you through the steps
required to perform phylogenetic analyses of the example datasets. In
addition, we have provided the <code class="highlighter-rouge">Rev</code> scripts and output files for some
exercises so you can verify your results. (Note that since the MCMC runs
you perform will start from different random seeds, the output files
resulting from your analyses <em>will not</em> be identical to the ones we
provide you.)</p>

<h1 id="probabilistic-graphical-models">Probabilistic Graphical Models</h1>

<p>RevBayes uses <em>probabilistic graphical models</em> for model
specification, visualization, and implementation <a href="#Hoehna2014b">(Höhna et al. 2014)</a>.
Graphical models are frequently used in machine learning and statistics
to conceptually represent the conditional dependence structure of
complex statistical models with many parameters
(missing reference). The
graphical model framework allows for flexible model specification and
implementation and reduces redundant code. This framework provides a set
of symbols for depicting a <a href="http://en.wikipedia.org/wiki/Directed_acyclic_graph"><em>directed acyclic
graph</em></a> (DAG).
@Hoehna2014b described the use of probabilistic graphical models for
phylogenetics. The different nodes and components of a phylogenetic
graphical model are shown in Figure [gmnotation] [Fig. 1 from
@Hoehna2014b].</p>

<blockquote class="figure">
  <p><img src="figures/GM_notation_figure.png" alt="" /> 
The symbols for a
visual representation of a graphical model. a) Solid squares represent
constant nodes, which specify fixed-valued variables. b) Stochastic
nodes are represented by solid circles. These variables correspond to
random variables and may depend on other variables. c) Deterministic
nodes (dotted circles) indicate variables that are determined by a
specific function applied to another variable. They can be thought of as
variable transformations. d) Observed states are placed in clamped
stochastic nodes, represented by gray-shaded circles. e) Replication
over a set of variables is indicated by enclosing the replicated nodes
in a plate (dashed rectangle). [Partially reproduced from Fig. 1 in
@Hoehna2014b.]</p>
</blockquote>

<p>To represent the DAG, nodes are connected with arrows indicating
dependency. A simple, albeit abstract, graphical model is shown in
Figure [simpleGM]. In this model, we observe a set of states for
parameter $x$. We assume that the values of $x$ are samples from a
lognormal distribution with a location parameter (log mean) $\mu$ and a
standard deviation $\sigma$. It is more straightforward to model our
uncertainty in the expectation of a lognormal distribution, rather than
$\mu$, thus we place a gamma distribution on the mean $M$. This gamma
hyperprior has two parameters that we specify with fixed values
(constant nodes): the shape $\alpha$ and rate $\beta$. The variable $M$
is a stochastic node with this prior density. The standard deviation,
$\sigma$, is also a stochastic node with an exponential prior density
with rate parameter $\lambda$. For any value of $M$ and any value of
$\sigma$ we can compute the deterministic variable $\mu$ using the
formula $\mu = \ln(M) - \frac{\sigma^2}{2}$. This formula is known from
using simple algebra on the equation for the mean of any <a href="http://en.wikipedia.org/wiki/Log-normal_distribution">lognormal
distribution</a>.
With this model structure, we can then calculate the probability of the
data conditional on the model and parameter values (the likelihood):
$\mathbb{P}(\boldsymbol{x} \mid \mu, \sigma)$. Next we can get the
posterior probability using Bayes’ theorem:
<script type="math/tex">\mathbb{P}(M,\sigma \mid \boldsymbol{x}, \alpha, \beta, \lambda) = \frac{\mathbb{P}(\boldsymbol{x} \mid \mu, \sigma) \mathbb{P}(M \mid \alpha,\beta) \mathbb{P}(\sigma \mid \lambda)}{\mathbb{P}(\boldsymbol{x})}.</script></p>

<blockquote class="figure">
  <p><img src="figures/simple_GM.png" alt="" /> 
Graphical model
representation of a simple lognormal model. A total of $N$ observations
of variable $x$ are observed and occupy a clamped node. This parameter
is log-normally distributed with parameters $\mu$ and $\sigma$ (log mean
and standard deviation, respectively). The parameter $\mu$ is a
deterministic node that is calculated from the stochastic nodes $M$ (the
mean of the distribution) and $\sigma$. Dotted arrows indicate
deterministic functions and are used to connect deterministic nodes to
their parent variables. A gamma distribution is applied as a hyperprior
on $M$ with constant nodes for the shape $\alpha$ and rate $\beta$.The
stochastic variable $\sigma$ is exponentially distributed with fixed
value for the rate $\lambda$.</p>
</blockquote>

<h1 id="rev-the-revbayes-language"><code class="highlighter-rouge">Rev</code>: The RevBayes Language</h1>

<p>In RevBayes models and analyses are specified using an interpreted
language called <code class="highlighter-rouge">Rev</code>. <code class="highlighter-rouge">Rev</code> bears similarities to the compiled language
in WinBUGS and the interpreted <code class="highlighter-rouge">R</code>language. Setting up and
executing a statistical analysis in RevBayes requires the user to
specify all of the parameters of their model and the type of analysis
(<em>e.g.,</em>an MCMC run). By using an interpreted
language, RevBayes enables the practitioner to build complex,
hierarchical models and to check the current states of variables while
building the model. This will be very useful in the beginning. Later on
you, when you run very complex analyses, you may want to write
<code class="highlighter-rouge">Rev</code>-scripts.</p>

<p>Differently to <code class="highlighter-rouge">R</code>and BUGS, <code class="highlighter-rouge">Rev</code> is a strongly but
implicitly typed language. It is implicitly typed, and thus similar to
Python, because you do not need to provide the type of a variable (which
you need to in languages such as C++ and Java). We do implicit typing to
help users who do not know about the actual types of the variables.
However, strongly typed means that every variable has a type and
arguments of functions need to match the required types. The strong type
requirements ensures that you build meaningful model graphs. For
example, the variance parameter of a normal distribution needs to be a
positive number, and thus you can only use variables that are positive
real numbers. RevBayes does automatic type conversion.</p>

<h2 id="specifying-models">Specifying Models</h2>

<p>@l c r  &amp; &amp;\
<code class="highlighter-rouge">&lt;-</code> &amp;</p>

<p>&amp; constant variable\
‘~’ &amp;</p>

<p>&amp; stochastic variable\
<code class="highlighter-rouge">:=</code> &amp;</p>

<p>&amp; deterministic variable\
<code class="highlighter-rouge">node.clamp(data)</code> &amp;</p>

<p>&amp; clamped variable\
<code class="highlighter-rouge">=</code> &amp;</p>

<p>&amp; inference (<em>i.e.,</em>non-model) variable\
<code class="highlighter-rouge">for(i in 1:N){...}</code> &amp;</p>

<p>&amp; plate\</p>

<p>The variables/parameters of a statistical model are created using
different operators in <code class="highlighter-rouge">Rev</code> (Table [operatorTable]). In Figure
[revgmexample], the <code class="highlighter-rouge">Rev</code> syntax for creating the model in Figure
[simpleGM] is provided. Because <code class="highlighter-rouge">Rev</code> is an interpreted language, it
is important to consider the order in which you specify your variables
(<em>cf.</em>BUGS where the order is not important).
Thus, typically the first variables that are instantiated are <em>constant
variables</em>. Constant variables require you to assign a fixed value using
the <code class="highlighter-rouge">&lt;-</code> operator. Stochastic variables are initialized using the ‘’
operator followed by the constructor function for a distribution. In
<code class="highlighter-rouge">Rev</code>, the naming convention for distributions is ‘dn*’, where ‘*’ is
a wildcard representing the name of the distribution. Each distribution
function requires hyperparameters passed in as arguments. This is
effectively linking nodes using arrows in the graphical model. The
following code snippet creates a stochastic variable called ‘M’ which is
assigned a gamma-distributed hyperprior, with shape ‘alpha’ and rate
‘beta’:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alpha &lt;- 2.0
beta &lt;- 4.0
M ~ dnGamma(alpha, beta)
</code></pre></div></div>

<p>The flexibility gained from the graphical model framework and the
interpreted language allows you to easily change a model by swapping
components. For example, if you decide that a bimodal lognormal
distribution is a better representation of your uncertainty in ‘M’, then
you can simply change the distribution associated with ‘M’ (after
initializing the bimodal lognormal hyperparameters):</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mean_1 &lt;- 0.5
mean_2 &lt;- 2.0
sd_1 &lt;- 1.0
sd_2 &lt;- 1.0
weight &lt;- 0.5
M ~ dnBimodalLognormal(mean_1, mean_2, sd_1, sd_2, weight)
</code></pre></div></div>

<p><code class="highlighter-rouge">Rev</code> does allow you to specify constant-variable values in the
distribution constructor function; therefore this also works:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>M ~ dnBimodalLognormal(0.5, 2.0, 1.0, 1.0, 0.5)
</code></pre></div></div>

<p>Both ways to specify priors are equivalent. The only difference is that
one code may be more readable than the other.</p>

<blockquote class="figure">
  <p><img src="figures/simple_GM_rev.png" alt="" /> 
Specifying a model with
<code class="highlighter-rouge">Rev</code>. The graphical model of the observed parameter $x$ is shown on the
left. In this example, $x$ is log-normally distributed with a location
parameter of $\mu$ and a standard deviation of $\sigma$, thus
$x \sim \mbox{Lognormal}(\mu, \sigma)$. The expected value of $x$ (or
mean) is equal to $M$: $\mathbb{E}(x) = M$. In this model, $M$ and
$\sigma$ are random variables and each are assigned hyperpriors. We
assume that the mean is drawn from a gamma distribution with shape
parameter $\alpha$ and rate parameter $\beta$:
$M \sim \mbox{Gamma}(\alpha, \beta)$. The standard deviation of the
lognormal distribution is assigned an exponential hyperprior with rate
$\lambda$: $\sigma \sim \mbox{Exponential}(\lambda)$. Since we are
conditioning our model on the <em>expectation</em>, we must compute the
location parameter ($\mu$) to calculate the probability of our model.
Thus, $\mu$ is a deterministic node that is the result of the
function$^<em>$ executed on $M$ and $\sigma$:
$\mu = \ln(M) - \frac{\sigma^2}{2}$. Since we observe values of $x$, we
*clamp</em> this node.</p>
</blockquote>

<p>Deterministic variables are parameter transformations and initialized
using the <code class="highlighter-rouge">:=</code> operator followed by the function or formula for
calculating the value. Previously we created a variable for the
expectation of the lognormal distribution. Now, if you have an
exponentially distributed stochastic variable $\sigma$, you can create a
deterministic variable for the mean $\mu$:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lambda &lt;- 1.0
sigma ~ dnExponential(lambda)
mu := ln(M) - (sigma^2)/2.0
</code></pre></div></div>

<p>Replication over lists of variables as a plate object is specified using
<code class="highlighter-rouge">for</code> loops. A for-loop is an iterator statement that performs a
function a given number of times. In <code class="highlighter-rouge">Rev</code> you can use this syntax to
create a vector of 7 stochastic variables, each drawn from a lognormal
distribution:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for( i in 1:7 ) {
  x[i] ~ dnLognormal(mu, sigma)
}
</code></pre></div></div>

<p>The <code class="highlighter-rouge">for</code> loop executes the statement ‘x[i] $\sim$ dnLognormal(mu,
sigma)’ for different values of $i$ repeatedly, where $i$ takes the
values 1 to 7. Thus, we created a vector $x$ of seven variables, each
being independent and identically distributed (i.i.d.).</p>

<p>A clamped node/variable has observed data attached to it. Thus, you must
first read in or input the data, then clamp it to a stochastic variable.
In Figure [revgmexample] the observations are assigned and clamped to
the stochastic variables. If we observed 7 values for ‘x’ we would
create 7 clamped variables:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>observations &lt;- [0.20, 0.21, 0.03, 0.40, 0.65, 0.87, 0.22]
N &lt;- observations.size()
for( i in 1:N ){
  x[i].clamp(observations[i])
}
</code></pre></div></div>

<p>You may notice that the value of $x$ has now changed and is equal to the
observations.</p>

<h1 id="getting-help-in-revbayes">Getting help in RevBayes</h1>

<p>RevBayes provides an elaborate help system. Most of the help is found
online on our website\
http://www.RevBayes.com. Within RevBayes you can display the help for
a function, distribution or any other type using the <code class="highlighter-rouge">?</code> symbol followed
by the command you want help for:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>?dnNorm
?mcmc
?mcmc.run
</code></pre></div></div>

<p>Additionally, RevBayes will print the correct usage of a function if
you only type in its name and hit return:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mcmc
</code></pre></div></div>

<div class="Rev-output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       MCMC function (Model model, Monitor[] monitors, Move[] moves, String moveschedule = "sequential" | "random" | "single", Natural nruns)
</code></pre></div></div>

<p>If you typed in <code class="highlighter-rouge">?dnNorm</code> and you didn’t see the help but got instead an
error message then you have most likely an incorrect path variable to
the help directory. You can check the current path to help directory by</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>getOption("helpdir")
</code></pre></div></div>

<div class="Rev-output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>       "/Users/hoehna/Software-Development/revbayes-development/help"
</code></pre></div></div>

<p>Check where the help files on your system are and then set the correct
path</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>setOption("helpdir", "/Users/hoehna/Software-Development/revbayes-development/help")
</code></pre></div></div>

<h2 id="revbayes-users-forum">RevBayes Users’ Forum</h2>

<p>An email list has been created for users of RevBayes to discuss
RevBayes-related topics, including: RevBayes installation and use,
scripting and programming, phylogenetics, population genetics, models of
evolution, graphical models, etc. The forum is hosted by Google Groups:</p>

<ul>
  <li><a href="http://bit.ly/107aW2R">revbayes-users</a>\</li>
</ul>


<ol class="bibliography"><li><span id="Hoehna2016b">Höhna S., Landis M.J., Heath T.A., Boussau B., Lartillot N., Moore B.R., Huelsenbeck J.P., Ronquist F. 2016. RevBayes: Bayesian Phylogenetic Inference Using Graphical Models and an Interactive Model-Specification Language. Systematic Biology. 65:726–736.</span>

<a href="https://doi.org/10.1093/sysbio/syw021">10.1093/sysbio/syw021</a>

</li>
<li><span id="Hoehna2014b">Höhna S., Heath T.A., Boussau B., Landis M.J., Ronquist F., Huelsenbeck J.P. 2014. Probabilistic Graphical Model Representation in Phylogenetics. Systematic Biology. 63:753–771.</span>

<a href="https://doi.org/10.1093/sysbio/syu039">10.1093/sysbio/syu039</a>

</li></ol>

<script type="text/javascript">
var _ol = document.querySelectorAll('ol');
for (var i = 0, elem_ol; elem_ol = _ol[i]; i++) {
	if ( elem_ol.classList == "bibliography" ) {
		var _li = elem_ol.getElementsByTagName("li");
		//for (var j = 0, elem_li; elem_li = _li[j]; j++)
		//{
		//	elem_li.innerHTML = elem_li.innerHTML.replace(/(https?:\/\/)([^\s<]+)/,"<a href=\"$1$2\">$2");
		//}
		if(_li.length > 0)
			elem_ol.outerHTML = "<h2 class='references'>References</h2><hr class='references'>"+elem_ol.outerHTML
	}
}
</script>

      <br>
<footer>
  <div class="container">
  <div class="row">
    <div class="col-sm-12" align="center">
      <a href="https://github.com/revbayes">GitHub</a> | <a href="/revbayes-site/license">License</a> | <a href="/revbayes-site/citation">Citation</a> | <a href="https://groups.google.com/forum/#!forum/revbayes-users">Users Forum</a>
    </div>
  </div>
  <br>
  </div>
</footer>

    </div>
    <script src="/revbayes-site/assets/js/vendor/jquery.min.js"></script>
<script src="/revbayes-site/assets/js/vendor/FileSaver.min.js"></script>
<script src="/revbayes-site/assets/js/vendor/jszip.min.js"></script>
<script src="/revbayes-site/assets/js/vendor/bootstrap.min.js"></script>

<script type="text/javascript">
// Add default language
$(":not(code).highlighter-rouge").each(function() {
  
  if( this.classList == "highlighter-rouge") {
    this.classList = "Rev highlighter-rouge";
  }
  
});
// $("code.highlighter-rouge").each(function() {
//   
//   if( this.classList == "highlighter-rouge") {
//       this.classList = "Rev highlighter-rouge";
//   }
//   
// });
</script>

<script src="/revbayes-site/assets/js/base.js"></script>

<script type="text/javascript"
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
  });
</script>

  </body>
</html>
