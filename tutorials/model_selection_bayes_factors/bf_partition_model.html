<!doctype html>
<html lang="en">
<link rel="icon" type="image/png" href="/assets/img/favicon.png" >
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="search-domain" value="https://revbayes.github.io/">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <title>RevBayes: Model selection of partition models</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <a href="/" class="pull-left">
        
        <img class="navbar-logo" src="/assets/img/aquabayes-desaturated.png" alt="RevBayes Home" />
        
      </a>

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar" align="right"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="/download">Download</a></li>
        <li><a href="/tutorials/">Tutorials</a></li>
        <li><a href="/documentation/">Documentation</a></li>
        <li><a href="/interfaces">Interfaces</a></li>
        <li><a href="/workshops/">Workshops</a></li>
        <li><a href="/jobs/">Jobs</a></li>
        <li><a href="/developer/">Developer</a></li>
        <li><class="header-search">
  <form class="header-search-form" action="/search.html" method="get">
    <input type="text" id="search-box-nav" placeholder="Search..." name="query" style="border-color:black;background-color:white;height:32px;">
    <button type="submit" style="color:black; border-color:black;width:32px;height:32px;padding-top:4px">
        <img src="assets/img/search.png" height="22px" width="28px"/>
    </button>
  </form>
</div>

</li>
      </ul>
      <!-- <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form> -->
    </div>
  </div>
</nav>

      <div class="titlebar">
	<h1 class="maintitle">Model selection of partition models</h1>
	<h3 class="subtitle">Comparing relative model fit with Bayes factors</h3>
	<h4 class="authors">Mike May and Sebastian Höhna</h4>
  <h5>Last modified on April  9, 2024</h5>
</div>


<div class="sidebar no-print">
<blockquote class="overview" id="overview">
  <h2>Overview</h2>
  
  <div class="row">
    <div class="col-md-9">
        <strong>Prerequisites</strong>
        
          <ul id="prerequisites">
          
            <li><a href="/tutorials/intro/">Getting Started with RevBayes and Rev Language Syntax</a></li>
          
            <li><a href="/tutorials/mcmc/">Introduction to Markov chain Monte Carlo (MCMC) Sampling</a></li>
          
            <li><a href="/tutorials/model_selection_bayes_factors/bf_intro.html">General Introduction to Model selection</a></li>
          
            <li><a href="/tutorials/model_selection_bayes_factors/bf_subst_model.html">Model selection of common substitution models for one locus</a></li>
          
          </ul>
        
    </div>
  </div>
  
</blockquote>





<blockquote class="tutorial_files" id="tutorial_files">
    <h2>Data files and scripts</h2>
    
        
        <strong>Data Files</strong>
        <ul id="data_files">
        
        
        
          <li><a href="/tutorials/model_selection_bayes_factors/data/fagus_ITS.nex">fagus_ITS.nex</a></li>
        
          <li><a href="/tutorials/model_selection_bayes_factors/data/fagus_matK.nex">fagus_matK.nex</a></li>
        
          <li><a href="/tutorials/model_selection_bayes_factors/data/fagus_rbcL.nex">fagus_rbcL.nex</a></li>
        
        </ul>
    
        
        <strong>Scripts</strong>
        <ul id="scripts">
        
        
        
          <li><a href="/tutorials/model_selection_bayes_factors/scripts/marginal_likelihood_partition_1.Rev">marginal_likelihood_partition_1.Rev</a></li>
        
          <li><a href="/tutorials/model_selection_bayes_factors/scripts/marginal_likelihood_partition_2.Rev">marginal_likelihood_partition_2.Rev</a></li>
        
          <li><a href="/tutorials/model_selection_bayes_factors/scripts/marginal_likelihood_partition_3.Rev">marginal_likelihood_partition_3.Rev</a></li>
        
          <li><a href="/tutorials/model_selection_bayes_factors/scripts/marginal_likelihood_partition_4.Rev">marginal_likelihood_partition_4.Rev</a></li>
        
          <li><a href="/tutorials/model_selection_bayes_factors/scripts/marginal_likelihood_partition_5.Rev">marginal_likelihood_partition_5.Rev</a></li>
        
        </ul>
    
</blockquote>


</div>
<h2 class="section" id="overview">Overview</h2>
<hr class="section" />

<p>You should read first the <a href="/tutorials/model_selection_bayes_factors/bf_intro.html">General Introduction to Model selection</a> tutorial, which explains the theory and 
standard algorithms for estimating marginal likelihoods and Bayes factors.
Additionally, you may want to work through the <a href="/tutorials/model_selection_bayes_factors/bf_subst_model.html">Model selection of common substitution models for one locus</a> tutorial,
which estimates marginal likelihoods for different substitution models for one locus, before attempting this tutorial.</p>

<h2 class="section" id="comparing-partitioned-models-using-bayes-factors">Comparing Partitioned Models Using Bayes Factors</h2>
<hr class="section" />

<p>For this tutorial you should download the sequence data, <em>ITS</em>, <em>matK</em>, and <em>rbcL</em>. 
These new sequence data are for the genus <em>Fagus</em>, the beeches.</p>

<p>Data partitions allow us to apply different substitution models to different loci 
in order to accommodate process heterogeneity (variation in the substitution process among sequences). 
The substitution models may be of the same form (i.e., they may all be GTR models), 
or of entirely different forms (i.e, some may be HKY, while others are GTR). 
Just because two loci have the same form of substitution model does not necessarily mean 
they share the same substitution models; for example, we determined that the GTR model 
is preferred for each of the loci above, but it is possible that the stationary frequencies 
and relative rate parameters for these loci are different (i.e., they have different substitution models).</p>

<p>According to our previous analysis, we could partition our <em>Fagus</em> data so that each locus 
has the same or different substitution model parameters. 
Each of these choices imply different phylogenetic models, 
and thus we can choose among partitioned models using Bayes factors.</p>

<h3 class="subsection" id="the-uniform-partitioned-model">The Uniform Partitioned Model</h3>
<hr class="subsection" />

<p>If we assigned the same GTR+G to each locus, we would be assuming that the process of evolution 
is the same among loci (we often call this the “uniform model”). 
We can specify this uniform partition model by using the same $Q$ matrix and ASRV model for each alignment. 
Open the file <code class="language-plaintext highlighter-rouge">marginal_likelihood_partition_1.Rev</code> and examine how we specify this model. 
In particular, note that <code class="language-plaintext highlighter-rouge">dnPhyloCTMC models</code> all use the same <code class="language-plaintext highlighter-rouge">Q</code> matrix and <code class="language-plaintext highlighter-rouge">site_rates</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>seq_ITS ~ dnPhyloCTMC(tree=phylogeny, Q=Q, type="DNA", siteRates=site_rates)
seq_ITS.clamp(data_ITS) # attach the observed data

seq_matK ~ dnPhyloCTMC(tree=phylogeny, Q=Q, type="DNA", siteRates=site_rates)
seq_matK.clamp(data_matK) # attach the observed data

seq_rbcL ~ dnPhyloCTMC(tree=phylogeny, Q=Q, type="DNA", siteRates=site_rates)
seq_rbcL.clamp(data_rbcL) # attach the observed data
</code></pre></div></div>

<h3 class="subsection" id="the-saturated-model">The Saturated Model</h3>
<hr class="subsection" />

<p>At the opposite end of the spectrum, the “saturated” model applies a different substitution model to each locus, and each locus receives its own subset-specific rate multiplier (with the contraint that the mean rate is 1!). 
Open the script <code class="language-plaintext highlighter-rouge">marginal_likelihood_partition_5.Rev</code> to see how this model is specified. 
Notice how the subset-specific rates are specified:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>num_sites[1] = data_ITS.nchar()
num_sites[2] = data_matK.nchar()
num_sites[3] = data_rbcL.nchar()

relative_rates ~ dnDirichlet(v(1,1,1))
moves.append( mvBetaSimplex(relative_rates, weight=1.0) )

subset_rates := relative_rates * sum(num_sites) / num_sites
</code></pre></div></div>
<p>(The last line forces the <code class="language-plaintext highlighter-rouge">subset_rates</code> to have a mean of 1.)</p>

<p>Notice also that each <code class="language-plaintext highlighter-rouge">dnPhyloCTMC</code> is receiving a different <code class="language-plaintext highlighter-rouge">Q</code>, <code class="language-plaintext highlighter-rouge">subset_rates</code> <code class="language-plaintext highlighter-rouge">site_rates</code> argument:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>seq_ITS ~ dnPhyloCTMC(tree=phylogeny, branchRates=subset_rates[1],
                      Q=Q_ITS, type="DNA", siteRates=site_rates_ITS)
seq_ITS.clamp(data_ITS) # attach the observed data

seq_matK ~ dnPhyloCTMC(tree=phylogeny, branchRates=subset_rates[2],
                       Q=Q_matK, type="DNA", siteRates=site_rates_matK)
seq_matK.clamp(data_matK) # attach the observed data

seq_rbcL ~ dnPhyloCTMC(tree=phylogeny, branchRates=subset_rates[3],
                       Q=Q_rbcL, type="DNA", siteRates=site_rates_rbcL)
seq_rbcL.clamp(data_rbcL) # attach the observed data
</code></pre></div></div>

<h3 class="subsection" id="in-class-exercises">In-Class Exercises</h3>
<hr class="subsection" />

<ol>
  <li>Download the <code class="language-plaintext highlighter-rouge">Rev</code> script associated with your assigned partition model. 
Note how this script implements the particular partition model and the power posterior analysis.</li>
  <li>Execute your <code class="language-plaintext highlighter-rouge">Rev</code> script. This can take a long time; please be patient! 
Once your stepping-stone analysis is complete, record your result on the <a href="https://docs.google.com/spreadsheets/d/1m-hWOTHg3T5gP0XHPCB_m4jK5qaCfcTYM40svjew9Go/edit?usp=sharing">Google spreadsheet</a>.</li>
</ol>

<ol class="bibliography"></ol>

<script type="text/javascript">
var _ol = document.querySelectorAll('ol');
for (var i = 0, elem_ol; elem_ol = _ol[i]; i++) {
	if ( elem_ol.classList == "bibliography" ) {
		var _li = elem_ol.getElementsByTagName("li");
		//for (var j = 0, elem_li; elem_li = _li[j]; j++)
		//{
		//	elem_li.innerHTML = elem_li.innerHTML.replace(/(https?:\/\/)([^\s<]+)/,"<a href=\"$1$2\">$2");
		//}
		if(_li.length > 0)
			elem_ol.outerHTML = "<h2 class='references'>References</h2><hr class='references'>"+elem_ol.outerHTML
	}
}
</script>

      <br>
<footer>
  <div class="container">
  <div class="row">
    <div class="col-sm-12" align="center">
      <a href="https://github.com/revbayes">GitHub</a> | <a href="/license">License</a> | <a href="/citation">Citation</a> | <a href="https://groups.google.com/forum/#!forum/revbayes-users">Users Forum</a>
    </div>
  </div>
  <br>
  </div>
</footer>

    </div>
    <script src="/assets/js/vendor/jquery.min.js"></script>
<script src="/assets/js/vendor/FileSaver.min.js"></script>
<script src="/assets/js/vendor/jszip.min.js"></script>
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<script type="text/javascript">
// Add default language
$(":not(code).highlighter-rouge").each(function() {
  
  if( this.classList == "highlighter-rouge") {
    this.classList = "Rev highlighter-rouge";
  }
  
});
// $("code.highlighter-rouge").each(function() {
//   
//   if( this.classList == "highlighter-rouge") {
//       this.classList = "Rev highlighter-rouge";
//   }
//   
// });
</script>
<script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
    });
    MathJax.Hub.Queue(function () {
      $(".aside").each(function() {
          $("div .MathJax", this).hide();
      });
    });
</script>
<script src="/assets/js/base.js"></script>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0Y03X9Q2TJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0Y03X9Q2TJ');
</script>

  </body>
</html>
