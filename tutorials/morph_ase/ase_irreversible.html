<!doctype html>
<html lang="en">
<link rel="icon" type="image/png" href="/assets/img/favicon.png" >
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="search-domain" value="https://revbayes.github.io/">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <title>RevBayes: Discrete morphology - Ancestral State Estimation and Irreversibility</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <a href="/" class="pull-left">
        
        <img class="navbar-logo" src="/assets/img/aquabayes-desaturated.png" alt="RevBayes Home" />
        
      </a>

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar" align="right"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="/download">Download</a></li>
        <li><a href="/tutorials/">Tutorials</a></li>
        <li><a href="/documentation/">Documentation</a></li>
        <li><a href="/interfaces">Interfaces</a></li>
        <li><a href="/workshops/">Workshops</a></li>
        <li><a href="/jobs/">Jobs</a></li>
        <li><a href="/developer/">Developer</a></li>
      </ul>
      <!-- <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form> -->
    </div>
  </div>
</nav>

      <div class="titlebar">
	<h1 class="maintitle">Discrete morphology - Ancestral State Estimation and Irreversibility</h1>
	<h3 class="subtitle">Testing for Irreversibility</h3>
	<h4 class="authors">Sebastian Höhna</h4>
  <h5>Last modified on February 28, 2022</h5>
</div>


<div class="sidebar no-print">
<blockquote class="overview" id="overview">
  <h2>Overview</h2>
  
  <div class="row">
    <div class="col-md-9">
        <strong>Prerequisites</strong>
        
          <ul id="prerequisites">
          
            <li><a href="/tutorials/intro/">Getting Started with RevBayes and Rev Language Syntax</a></li>
          
            <li><a href="/tutorials/mcmc/">Introduction to Markov chain Monte Carlo (MCMC) Sampling</a></li>
          
            <li><a href="/tutorials/ctmc/">Nucleotide substitution models</a></li>
          
            <li><a href="/tutorials/morph_tree/">Discrete morphology - Tree Inference</a></li>
          
          </ul>
        
    </div>
  </div>
  
</blockquote>





<blockquote class="tutorial_files" id="tutorial_files">
    <h2>Data files and scripts</h2>
    
        
        <strong>Data Files</strong>
        <ul id="data_files">
        
        
        
          <li><a href="/tutorials/morph_ase/data/primates_activity_period.nex">primates_activity_period.nex</a></li>
        
          <li><a href="/tutorials/morph_ase/data/primates_diet.nex">primates_diet.nex</a></li>
        
          <li><a href="/tutorials/morph_ase/data/primates_habitat.nex">primates_habitat.nex</a></li>
        
          <li><a href="/tutorials/morph_ase/data/primates_males.nex">primates_males.nex</a></li>
        
          <li><a href="/tutorials/morph_ase/data/primates_mating_system.nex">primates_mating_system.nex</a></li>
        
          <li><a href="/tutorials/morph_ase/data/primates_morph.nex">primates_morph.nex</a></li>
        
          <li><a href="/tutorials/morph_ase/data/primates_morph_description.txt">primates_morph_description.txt</a></li>
        
          <li><a href="/tutorials/morph_ase/data/primates_solitariness.nex">primates_solitariness.nex</a></li>
        
          <li><a href="/tutorials/morph_ase/data/primates_terrestrially.nex">primates_terrestrially.nex</a></li>
        
          <li><a href="/tutorials/morph_ase/data/primates_tree.nex">primates_tree.nex</a></li>
        
        </ul>
    
        
        <strong>Scripts</strong>
        <ul id="scripts">
        
        
        
          <li><a href="/tutorials/morph_ase/scripts/mcmc_ase_irrev.Rev">mcmc_ase_irrev.Rev</a></li>
        
          <li><a href="/tutorials/morph_ase/scripts/plot_anc_states_irrev.R">plot_anc_states_irrev.R</a></li>
        
          <li><a href="/tutorials/morph_ase/scripts/plot_irrev.R">plot_irrev.R</a></li>
        
        </ul>
    
</blockquote>


</div>
<h2 class="section" id="sec_ase_ir_rj">Reversible-jump MCMC to test for irreversibility</h2>
<hr class="section" />

<p>In the previous section we assumed that there are 2 different rates, which are all $&gt;0$.
Now, we will apply a reversible-jump MCMC (missing reference) to test if any of the rates is significantly larger than $0$.</p>

<blockquote class="instruction">
  <p>Make a copy of the Rev script file you just made.
Call them `mcmc_ase_freeK_RJ.Rev.
This will contain the new model parameters and models.</p>
</blockquote>

<h3 class="subsection" id="modifying-the-mcmc-section">Modifying the MCMC Section</h3>
<hr class="subsection" />

<p>At each place in which the output files are specified in the MCMC section, change the output path so you don’t overwrite the output from the previous exercise.
For example, you might call your output file <code class="language-plaintext highlighter-rouge">output/solitariness_ase_irrev.log</code>.</p>

<h3 class="subsection" id="modifying-the-model-section">Modifying the Model Section</h3>
<hr class="subsection" />

<p>The only part in the model section that we are going to modify is the prior distributions and moves on the rate parameters.
We will assume the same rate for the exponential prior distribution as before.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>rate_pr := phylogeny.treeLength() / 10
</code></pre></div></div>
<p>Next, we specify that we have a 0.5 probability, <em>a priori</em>, that a rate is equal to 0.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mix_pr &lt;- 0.5
</code></pre></div></div>
<p>We will specify again our rates within a <code class="language-plaintext highlighter-rouge">for</code>-loop, which makes changing this script to other number of character states very easy.
We will explain each element within in the <code class="language-plaintext highlighter-rouge">for</code>-loop below.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>for ( i in 1:NUM_RATES ) {
    rate[i] ~ dnRJMixture(0.0, dnExp(rate_pr), p=mix_pr)
    prob_rate[i] := ifelse( rate[i] == 0, 1.0, 0.0 )
    moves.append( mvScale( rate[i], weight=2 ) )
    moves.append( mvRJSwitch( rate[i], weight=2 ) )
}
</code></pre></div></div>
<p>First, we can create our reversible-jump distributions <code class="language-plaintext highlighter-rouge">dnRJMixture</code>, which take in a constant value, 0.0 in this case, and a distribution <code class="language-plaintext highlighter-rouge">dnExp(rate_pr)</code>.
Thus, the value is either drawn to be exactly equal to the constant value (0.0 here), or drawn from the base distribution (the exponential distribution in this case).
The last argument specifies the probability of the constant value <code class="language-plaintext highlighter-rouge">p=mix_pr</code>, which is important later for model comparison.</p>

<p>Second, since we are interested in the probability that a rate is equal to 0.0, we want to compute this posterior probability directly.
Therefore, we will use the <code class="language-plaintext highlighter-rouge">ifelse</code> function, which will return 1.0 if the rate is equal to 0.0, and 0.0 otherwise (if the rate is unequal to 0.0).
Hence, the frequency with which we sample a 1.0 gives us the posterior probability that a given rate is equal to 0.0.</p>

<p>Third, we also need to specify specific moves that <em>jump</em> in parameter dimension.
We will use the <code class="language-plaintext highlighter-rouge">mvRJSwitch</code> move that changes the value to be either equal to the constant value
provided from the <code class="language-plaintext highlighter-rouge">dnRJMixture</code> or a value drawn from the base distribution (the exponential distribution).</p>

<p>Additionally, we also need to specify moves that change the rates if they are not equal to 0.0.
As usual, we use the standard scaling moves.</p>

<blockquote class="instruction">
  <p>This is all that you need to do for this ``fancy’’ reversible-jump model. Give it a try!</p>
</blockquote>

<h2 class="section" id="sec_ase_results">Evaluate and Summarize Your Results</h2>
<hr class="section" />

<h3 class="subsection" id="subsec_ase_plots">Visualizing Ancestral State Estimates</h3>
<hr class="subsection" />

<p>We have previously seen in <a href="/tutorials/morph_ase/ase.html">Discrete morphology - Ancestral State Estimation</a> and <a href="/tutorials/morph_ase/ase_free.html">Discrete morphology - Ancestral State Estimation with the independent rates model</a> how the ancestral states of the simple model equal rates Markov(ERM) model and the independent rates model look.
You should repeat plotting the ancestral states now also for the irreversible (<code class="language-plaintext highlighter-rouge">irrev</code>) analyses.
My output is shown in <a href="#fig_anc_states_irrev"></a></p>

<figure id="fig_anc_states_irrev"><p><img src="figures/Primates_solitariness_ASE_irrev_MAP.png" width="400" />
<img src="figures/Primates_solitariness_ASE_irrev_Pie.png" width="400" /></p>
<figcaption>Ancestral state estimates of solitariness under the irreversible model. You might see that some ancestral states have changed.</figcaption>
</figure>

<p>Next, we also want to see if there was support for the irreversible model.
Therefore, we will plot the probability that a rate was equal to 0.0.
You can do this nicely in <code class="language-plaintext highlighter-rouge">RevGadgets</code> <a class="citation" href="#Tribble2022">(Tribble et al. 2022)</a></p>
<pre><code class="language-{R}">library(RevGadgets)
library(ggplot2)

CHARACTER  &lt;- "solitariness"

# specify the input file
file &lt;- paste0("output/",CHARACTER,"_irrev.log")

# read the trace and discard burnin
trace_qual &lt;- readTrace(path = file, burnin = 0.25)

# produce the plot object, showing the posterior distributions of the rates.
p &lt;- plotTrace(trace = trace_qual,
          vars = paste0("prob_rate[",1:NUM_RATES,"]"))[[1]] +
     # modify legend location using ggplot2
     theme(legend.position = c(0.85,0.85))

ggsave(paste0("Primates_",CHARACTER,"_irrev.pdf"), p, width = 5, height = 5)
</code></pre>

<figure id="fig_prob_irrev"><p><img src="figures/Primates_solitariness_irrev.png" width="400" /></p>
<figcaption>Probability that a rate was equal to 0.0. We see ambiguous support that the rate of gain was equal to 0.0. Conversely, we don’t see any strong support that the rate of gain was not 0.0! We clearly see decisive support that the rate of loss was not equal to 0.0.</figcaption>
</figure>

<blockquote class="instruction">
  <p>Perform this test for irreversibility with different prior means, e.g., expecting 1 or 100 events along the tree.
Does this have an impact on your conclusion about irreversible evolution?</p>
</blockquote>

<blockquote class="instruction">
  <p>Click below to begin the next exercise!</p>
</blockquote>

<ul>
  <li><a href="/tutorials/morph_ase/scm_hrm">Stochastic Character Mapping and Testing for Rate Variation</a></li>
</ul>

<ol class="bibliography"><li><span id="Tribble2022">Tribble C.M., Freyman W.A., Landis M.J., Lim J.Y., Barido-Sottani J., Kopperud B.T., Höhna S., May M.R. 2022. RevGadgets: An R package for visualizing Bayesian phylogenetic analyses from RevBayes. Methods in Ecology and Evolution. 13:314–323.</span>

<a href="https://doi.org/https://doi.org/10.1111/2041-210X.13750">https://doi.org/10.1111/2041-210X.13750</a>

</li></ol>

<script type="text/javascript">
var _ol = document.querySelectorAll('ol');
for (var i = 0, elem_ol; elem_ol = _ol[i]; i++) {
	if ( elem_ol.classList == "bibliography" ) {
		var _li = elem_ol.getElementsByTagName("li");
		//for (var j = 0, elem_li; elem_li = _li[j]; j++)
		//{
		//	elem_li.innerHTML = elem_li.innerHTML.replace(/(https?:\/\/)([^\s<]+)/,"<a href=\"$1$2\">$2");
		//}
		if(_li.length > 0)
			elem_ol.outerHTML = "<h2 class='references'>References</h2><hr class='references'>"+elem_ol.outerHTML
	}
}
</script>

      <br>
<footer>
  <div class="container">
  <div class="row">
    <div class="col-sm-12" align="center">
      <a href="https://github.com/revbayes">GitHub</a> | <a href="/license">License</a> | <a href="/citation">Citation</a> | <a href="https://groups.google.com/forum/#!forum/revbayes-users">Users Forum</a>
    </div>
  </div>
  <br>
  </div>
</footer>

    </div>
    <script src="/assets/js/vendor/jquery.min.js"></script>
<script src="/assets/js/vendor/FileSaver.min.js"></script>
<script src="/assets/js/vendor/jszip.min.js"></script>
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<script type="text/javascript">
// Add default language
$(":not(code).highlighter-rouge").each(function() {
  
  if( this.classList == "highlighter-rouge") {
    this.classList = "Rev highlighter-rouge";
  }
  
});
// $("code.highlighter-rouge").each(function() {
//   
//   if( this.classList == "highlighter-rouge") {
//       this.classList = "Rev highlighter-rouge";
//   }
//   
// });
</script>
<script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
    });
    MathJax.Hub.Queue(function () {
      $(".aside").each(function() {
          $("div .MathJax", this).hide();
      });
    });
</script>
<script src="/assets/js/base.js"></script>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0Y03X9Q2TJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0Y03X9Q2TJ');
</script>

  </body>
</html>
