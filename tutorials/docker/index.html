<!doctype html>
<html lang="en">
<link rel="icon" type="image/png" href="/assets/img/favicon.png" >
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="search-domain" value="https://revbayes.github.io/">
    <link href="https://fonts.googleapis.com/css?family=Raleway" rel="stylesheet">
    <link rel="stylesheet" href="/assets/css/syntax.css">
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/bootstrap-theme.css" />
    <link rel="stylesheet" type="text/css" href="/assets/css/main.css" />
    <title>RevBayes: Using RevBayes with Docker</title>
  </head>
  <body>
    <div class="container">
      <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container-fluid">
    <div class="navbar-header">
      <a href="/" class="pull-left">
        
        <img class="navbar-logo" src="/assets/img/aquabayes-desaturated.png" alt="RevBayes Home" />
        
      </a>

      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar" align="right"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

    </div>
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li><a href="/download">Download</a></li>
        <li><a href="/tutorials/">Tutorials</a></li>
        <li><a href="/documentation/">Documentation</a></li>
        <li><a href="/interfaces">Interfaces</a></li>
        <li><a href="/workshops/">Workshops</a></li>
        <li><a href="/jobs/">Jobs</a></li>
        <li><a href="/developer/">Developer</a></li>
        <li><class="header-search">
  <form class="header-search-form" action="/search.html" method="get">
    <input type="text" id="search-box-nav" placeholder="Search..." name="query" style="border-color:black;background-color:white;height:32px;">
    <button type="submit" style="color:black; border-color:black;width:32px;height:32px;padding-top:4px">
        <img src="https://revbayes.github.io/assets/img/search.png" height="22px" width="28px"/>
    </button>
  </form>
</div>

</li>
      </ul>
      <!-- <form class="navbar-form navbar-right" role="search" id="search" onsubmit="google_search(); return false;">
        <div class="form-group">
          <input type="text" id="google-search" placeholder="Search..." aria-label="Google site search">
        </div>
      </form> -->
    </div>
  </div>
</nav>

      <!-- adds margin to main content -->
      <div class="container">
          <div class="titlebar">
	<h1 class="maintitle">Using RevBayes with Docker</h1>
	<h3 class="subtitle">Using a platform-independent container to run RevBayes on your computer or a computing cluster</h3>
	<h4 class="authors">Sarah Swiston and Michael Landis</h4>
  <h5>Last modified on May 27, 2024</h5>
</div>


<div class="sidebar no-print">
<blockquote class="overview" id="overview">
  <h2>Overview</h2>
  
  <div class="row">
    <div class="col-md-9">
        <strong>Prerequisites</strong>
        
          <ul>
          <li>None</li>
          </ul>
        
    </div>
  </div>
  
</blockquote>





<blockquote class="tutorial_files" id="tutorial_files">
    <h2>Data files and scripts</h2>
    
        
        <strong>Scripts</strong>
        <ul id="scripts">
        
        
        
          <li><a href="/tutorials/docker/scripts/test.Rev">test.Rev</a></li>
        
        </ul>
    
</blockquote>


</div>
<h2 class="section" id="overview">Overview</h2>
<hr class="section" />

<p>Docker is a way to share pre-built, pre-configured, and platform-independent sets of programs and files. The PhyloDocker image described below comes pre-configured with RevBayes, the TensorPhylo library, and other useful software.</p>

<p>As a user, you download and a build a Docker image. Once built, you can create a Docker container from that image. Each Docker image lives on your computer and uses its resources for work. In this way, you can think of Docker as a program that runs a miniature “virtual” computer through your actual computer. A container built from PhyloDocker can be used to run RevBayes, just like you would through the terminal, but without needing to install and configure RevBayes yourself. For example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>~ $ ### from terminal on my Mac laptop (host)
~ $ docker run --name phylodocker_demo --volume /Users/mlandis/projects/docker_test:/docker_test -it sswiston/phylo_docker:slim_amd64

~ # ### from terminal inside Docker container
~ # cd docker_test/
/docker_test # ls
history.txt  test.Rev
/docker_test # rb test.Rev

RevBayes version (1.2.2)
Build from remotes/origin/stochmap_tp_dirty_merge (rapture-2396-g55c817) on Mon May 20 16:11:27 UTC 2024

Visit the website www.RevBayes.com for more information about RevBayes.

RevBayes is free software released under the GPL license, version 3. Type 'license()' for details.

To quit RevBayes type 'quit()' or 'q()'.


&gt; source("test.Rev")
   Processing file "test.Rev"
Congrats! RevBayes is working!

/docker_test # ### new file in container will be visible to laptop
/docker_test # touch new_file.txt
/docker_test # ls
new_file.txt  test.Rev
/docker_test # exit

~ $ ### back on my laptop (host)
~ $ ls /Users/mlandis/projects/docker_test
new_file.txt  test.Rev

~ $ ### reconnect to Docker container
~ $ docker start -ai phylodocker_demo
~ # 
</code></pre></div></div>

<p>On the development side, a <strong>Dockerfile</strong> (a list of commands for building and configuring programs/files) is used to build an <strong>image</strong>, which can then be shared with others. On the user side, the image can be downloaded and run to create a <strong>container</strong>. Inside the container, you have access to all of the programs contained in the image, as well as any files you <strong>mount</strong> to the container when you run the image. It works a bit like a virtual machine, except it runs on top of the host operating system. A Docker image containing RevBayes, TensorPhylo, Python, R, Julia, and several other programs can be found on <a href="https://hub.docker.com/r/sswiston/phylo_docker">Docker Hub</a>.</p>

<p>This tutorial explains how to install Docker on your computer, how to obtain a RevBayes Docker image, and how to use the image to run scripts on your computer or a computing cluster. This will require a basic familiarity with command line (navigating directories and entering basic commands), but does not require much programming.</p>

<h2 class="section" id="setting-up-the-tutorial">Setting up the tutorial</h2>
<hr class="section" />

<h3 class="subsection" id="downloading-a-test-script">Downloading a test script</h3>
<hr class="subsection" />

<p>This tutorial includes a test script called <code class="language-plaintext highlighter-rouge">test.Rev</code> so that you can assess whether the RevBayes Docker container is functioning properly after being installed. The test script can be found in the <code class="language-plaintext highlighter-rouge">Data files and scripts</code> box in the left sidebar of the tutorial page. Somewhere on your computer, you should create a directory (folder) for this tutorial, download the test script, and put the test script inside the directory. You can put this directory anywhere you want on your computer, but you will need to know the filepath to the directory in order to access it from the Docker container.</p>

<h2 class="section" id="setting-up-docker">Setting up Docker</h2>
<hr class="section" />

<h3 class="subsection" id="joining-docker-hub">Joining Docker Hub</h3>
<hr class="subsection" />

<p>On <a href="https://hub.docker.com/">Docker Hub</a>, there are many Docker images available that contain a wide variety of programs. To use these images (including the RevBayes image), you will need to create an account. Docker Hub is free to join.</p>

<h3 class="subsection" id="installing-docker-desktop">Installing Docker Desktop</h3>
<hr class="subsection" />

<p>In order to use Docker on your computer, you will have to download and install <a href="https://www.docker.com/products/docker-desktop/">Docker Desktop</a>. The desktop app allows your computer to run Docker images, and also provides a GUI for interacting with images and containers. Whenever you want to use a Docker image, you will need to start the Docker daemon first, and opening Docker Desktop is the simplest way to do this (although there are a few <a href="https://docs.docker.com/config/daemon/start/">other ways</a> to start the Docker daemon). Docker has versions for Mac, Windows, and Linux. The RevBayes Docker image should work on any of these platforms.</p>

<figure id="example"><p><img src="figures/docker_desktop.png" width="60%" /></p>
<figcaption>Example view of containers in Docker Desktop.</figcaption>
</figure>

<p>This is a reference to <a href="#example"></a></p>

<h3 class="subsection" id="downloading-the-image">Downloading the image</h3>
<hr class="subsection" />

<p>A Docker image containing RevBayes, TensorPhylo, Python, R, and other dependencies can be found at <a href="https://hub.docker.com/r/sswiston/phylo_docker">hub.docker.com/r/sswiston/phylo_docker</a>. The easiest way to obtain this image is with a <code class="language-plaintext highlighter-rouge">docker pull</code> command.</p>

<p>First, open Docker Desktop. This starts the Docker daemon so that you can run <code class="language-plaintext highlighter-rouge">docker</code> commands. If you do not open Docker Desktop first, you will receive an error when you try to run a <code class="language-plaintext highlighter-rouge">docker</code> command. Then, in the desktop app, sign into your Docker Hub account.</p>

<p>Next, you will need to pull a <code class="language-plaintext highlighter-rouge">phylo_docker</code> image with a tag that matches your computer’s hardware architecture. The two tagged versions currently supported are <code class="language-plaintext highlighter-rouge">phylo_docker:slim_amd64</code> and <code class="language-plaintext highlighter-rouge">phylo_docker:slim_arm64</code>. Consult the table below if you are unsure which tagged image to use.</p>

<table>
  <thead>
    <tr>
      <th>OS</th>
      <th>CPU</th>
      <th>Manufacture date</th>
      <th>Tagged image</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Windows or Linux</td>
      <td>Intel or AMD</td>
      <td>–</td>
      <td><code class="language-plaintext highlighter-rouge">phylo_docker:slim_amd64</code></td>
    </tr>
    <tr>
      <td>Mac OS X</td>
      <td>Intel</td>
      <td>2019 or earlier</td>
      <td><code class="language-plaintext highlighter-rouge">phylo_docker:slim_amd64</code></td>
    </tr>
    <tr>
      <td>Mac OS X</td>
      <td>Silicon M1, M2, etc.</td>
      <td>after 2019</td>
      <td><code class="language-plaintext highlighter-rouge">phylo_docker:slim_arm64</code></td>
    </tr>
  </tbody>
</table>

<p>Next, open your command line and enter the appropriate pull command:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># For Intel/AMD computers
docker pull sswiston/phylo_docker:slim_amd64

# For Apple Silicon (M1, M2, etc.) computers
docker pull sswiston/phylo_docker:slim_arm64
</code></pre></div></div>

<p>Docker will automatically store the image on your computer in a directory reserved for Docker images. You will not have to manually locate this image; Docker will be able to find it.</p>

<h3 class="subsection" id="special-instructions-for-windows-users">Special instructions for Windows users</h3>
<hr class="subsection" />

<p>Your Windows operating system uses Docker to run a PhyloDocker container. The container itself runs a virtual computing environment using the Linux operating system, Alpine.</p>

<ul>
  <li>If you are not familiar with Linux, find a short list of important commands here: <a href="https://mally.stanford.edu/~sr/computing/basic-unix.html">link</a>.</li>
  <li>Docker expects Unix-style directory names, even if you are running Windows.  Converting from Windows to Unix-style directories is easy. The Windows-style directory path <code class="language-plaintext highlighter-rouge">C:\\Users\charles_darwin\my_project</code> becomes the Unix-style directory path <code class="language-plaintext highlighter-rouge">/c/Users/mlandis/charles_darwin/my_project</code>. Use Unix-style directory paths when mounting directories from your computer (the host) on a new container (see below).</li>
</ul>

<h2 class="section" id="using-revbayes-via-docker">Using RevBayes via Docker</h2>
<hr class="section" />

<h3 class="subsection" id="running-revbayes-image-via-command-line">Running RevBayes image via command line</h3>
<hr class="subsection" />

<p>You can also run the RevBayes Docker image directly from command line. This will still require opening Docker Desktop to start the Docker daemon.</p>

<ol>
  <li>
    <p>Open Docker Desktop. You cannot run a Docker container from the command line unless the daemon is running. If you are not already signed in to your Docker Hub account, sign in now (there will be an option in the upper right corner of screen).</p>
  </li>
  <li>
    <p>Open command prompt.</p>
  </li>
  <li>
    <p>Run the command for opening the RevBayes Docker image:</p>

    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code> # For Intel/AMD computers
 docker run --name [my_container] --volume [local_directory]:[container_directory] -it sswiston/phylo_docker:slim_amd64
   
 # For Apple Silicon (M1, M2, etc.) computers
 docker run --name [my_container] --volume [local_directory]:[container_directory] -it sswiston/phylo_docker:slim_arm64
</code></pre></div>    </div>

    <p>Some parts of this command are directly analogous to the optional settings from the RevBayes GUI.</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">--name</code> adds a name to your container. This is not strictly necessary, but it’s very helpful if you plan to have multiple containers opened at a time. Otherwise, Docker will give the container a randomized name.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">--volume [local_directory]:</code> is how you tell Docker where to find your scripts on the host machine (your computer). To run the test script for this tutorial, you will have to tell Docker what directory to look in. You will need to use the absolute filepath to the directory. For example, if I put the test script in a directory called <code class="language-plaintext highlighter-rouge">docker_tutorial</code> on my desktop, I would put the filepath <code class="language-plaintext highlighter-rouge">/Users/Sarah/Desktop/docker_tutorial</code>. You can mount multiple directories from your host machine by adding multiple <code class="language-plaintext highlighter-rouge">--volume</code> arguments.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">[container_directory]</code> is how you will access your files while inside the Docker container. Mounting a directory in this way essentially creates a “connection” between the directory on the outside of the container (on your host machine) and inside the container. While inside the container, you will be able to see all of the contents of a mounted directory, including other sub-directories. For example, if you run RevBayes and want it to read a file from your host machine, you will use this filepath while inside the container. If you want to save files to your host machine from inside the Docker container, you will also use this filepath. There isn’t a specific place inside the Docker container where you have to mount the directory, and it doesn’t have to have the same name as the directory on your host machine. For example, you could call it <code class="language-plaintext highlighter-rouge">/tutorial</code>, which would put a directory called <code class="language-plaintext highlighter-rouge">tutorial</code> in the container’s home directory with your test script in it.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">-it</code> is for opening an interactive container. Docker containers can also be used to automatically run scripts and terminate when they are completed, but you will need an interactive container for this tutorial.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">sswiston/phylo_docker:slim_amd64</code> or <code class="language-plaintext highlighter-rouge">sswiston/phylo_docker:slim_arm64</code> (hardware-dependent, see above) is the name of the Docker image you want to use.</p>
      </li>
    </ul>

    <p>Congrats, you are inside the Docker container! You should be able to access all of the programs and files in the container, and also the directory you mounted from your host machine.</p>
  </li>
  <li>
    <p>Navigate to the location of your test script with <code class="language-plaintext highlighter-rouge">cd [filepath]</code>, using the filepath that you mounted your directory to in Step 3.</p>
  </li>
  <li>
    <p>Now you can use RevBayes to run the test script with the command <code class="language-plaintext highlighter-rouge">rb test.Rev</code>. This should open RevBayes and run the script, which will give a message indicating that it has been run correctly:</p>
  </li>
</ol>

<div class="language-plaintext Rev-output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   Processing file "test.Rev"
   Congrats! RevBayes is working!
</code></pre></div></div>

<h3 class="subsection" id="running-revbayes-image-via-docker-desktop">Running RevBayes image via Docker Desktop</h3>
<hr class="subsection" />

<blockquote class="info">
  <h2 id="docker-desktop-behaves-differently-across-versions">Docker Desktop behaves differently across versions</h2>
  <p>Some versions of Docker Desktop provide full support to run and interact with containers through the GUI. Unfortunately, its functionality changes across versions. To interact with a container through Docker Desktop v4.30.0 (current version as of writing this tutorial) you must first launch an interactive container using the commands above. Afterwards, you can interact with the running container through Docker Desktop. Previous versions of Docker Desktop allowed interactive sessions to be created from scratch, so this functionality will probably be restored in the future.</p>
</blockquote>

<p>You can use the Docker Desktop GUI to run the RevBayes Docker image (but see caveats in info box above). Once you have run the image, you will be able to use RevBayes inside the Docker container, and run scripts. Here are the steps you will need to get RevBayes running:</p>

<ol>
  <li>
    <p>Open Docker Desktop. If you are not already signed in to your Docker Hub account, sign in now (there will be an option in the upper right corner of screen).</p>
  </li>
  <li>
    <p>There will be a tab on the lefthand side called <code class="language-plaintext highlighter-rouge">images</code>. In this tab, you will see all of the images you have downloaded.</p>
  </li>
  <li>
    <p>Hovering over an image should give a <code class="language-plaintext highlighter-rouge">run</code> option. Click this option.</p>
  </li>
  <li>
    <p>This should bring you to a screen with a dropdown menu called <code class="language-plaintext highlighter-rouge">optional settings</code>. You will want to click on this menu and change a few settings.</p>
  </li>
  <li>
    <p><em>Add a name to your container.</em> This is not strictly necessary, but it’s very helpful if you plan to have multiple containers opened at a time. Otherwise, Docker will give the container a randomized name.</p>
  </li>
  <li>
    <p><em>Enter a host path.</em> This is how you tell Docker where to find your scripts on the host machine (your computer). To run the test script for this tutorial, you will have to tell Docker what directory to look in. You will need to use the absolute filepath to the directory. You can manually enter the filepath to this directory, or you can navigate to it using the <code class="language-plaintext highlighter-rouge">...</code> button. For example, if I put the test script in a directory called <code class="language-plaintext highlighter-rouge">docker_tutorial</code> on my desktop, I would put the filepath <code class="language-plaintext highlighter-rouge">/Users/Sarah/Desktop/docker_tutorial</code>. You can mount multiple directories from your host machine using the <code class="language-plaintext highlighter-rouge">+</code> button.</p>
  </li>
  <li>
    <p><em>Enter a container path.</em> This is how you will access your files while inside the Docker container. Mounting a directory in this way essentially creates a “connection” between the directory on the outside of the container (on your host machine) and inside the container. While inside the container, you will be able to see all of the contents of a mounted directory, including other sub-directories. For example, if you run RevBayes and want it to read a file from your host machine, you will use this filepath while inside the container. If you want to save files to your host machine from inside the Docker container, you will also use this filepath. There isn’t a specific place inside the Docker container where you have to mount the directory, and it doesn’t have to have the same name as the directory on your host machine. For example, you could call it <code class="language-plaintext highlighter-rouge">/tutorial</code>, which would put a directory called <code class="language-plaintext highlighter-rouge">tutorial</code> in the container’s home directory with your test script in it.</p>
  </li>
  <li>
    <p>Click the <code class="language-plaintext highlighter-rouge">run</code> option.</p>
  </li>
  <li>
    <p>Another tab on the lefthand side of the screen should be called <code class="language-plaintext highlighter-rouge">containers</code>. Clicking this option should bring you to a screen showing all of the containers you currently have running.</p>
  </li>
  <li>
    <p>There are two ways to access the container as it is running. The first way is to click on the running container inside the Containers panel, and then click on the Exec tab from the list of tabs at the top of the container menu. The second way is to find the running container inside the Containers panel, and then click on the icon with three vertical dots to the right of the container name. This will open a menu of options. Click on the “Open in terminal” menu item. Clicking this option will take you to the Exec tab, as in the first option. Congrats, you are inside the Docker container! You should be able to access all of the programs and files in the container, and also the directory you mounted from your host machine.</p>
  </li>
  <li>
    <p>Navigate to the location of your test script with <code class="language-plaintext highlighter-rouge">cd [filepath]</code>, using the filepath that you mounted your directory to in Step 7.</p>
  </li>
  <li>
    <p>Now you can use RevBayes to run the test script with the command <code class="language-plaintext highlighter-rouge">rb test.Rev</code>. This should open RevBayes and run the script, which will give a message indicating that it has been run correctly:</p>
  </li>
</ol>

<div class="language-plaintext Rev-output highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   Processing file "test.Rev"
   Congrats! RevBayes is working!
</code></pre></div></div>

<h2 class="section" id="running-on-a-cluster">Running on a cluster</h2>
<hr class="section" />

<p>Some high-performance computing clusters allow (or require) users to implement Docker images. For the most part, using a Docker image on a computing cluster is like using the image via command line on your own machine. You can mount directories, start a container, and use the programs inside to run scripts. However, there can be some additional considerations, depending on how the particular cluster is organized.</p>

<h3 class="subsection" id="example-wustl-ris">Example: WUSTL RIS</h3>
<hr class="subsection" />

<p>Washington University in Saint Louis Research Infrastructure Services (WUSTL RIS) has a scientific compute platform that requires Docker to run jobs. Each job opens a separate Docker container. Interactive jobs allow users to access an interactive container where they can enter commands, start programs, and run scripts. Non-interactive jobs open a non-interactive container that automatically runs certain scripts, and then both the container and job terminate. In this example, we will show a non-interactive job.</p>

<p>WUSTL RIS uses <code class="language-plaintext highlighter-rouge">bsub</code> commands to submit jobs. These commands can be written in one line, but they often have many arguments, so it can be helpful to put together a Bash script that constructs the <code class="language-plaintext highlighter-rouge">bsub</code> command. Here is an example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>LSF_DOCKER_VOLUMES="[Storage Directory]:/project"
PROJECTDIR="/project/"
NAME="MY_JOB"
OUTDIR="/project/joblogs/"

bsub \
-G [Compute Group] \
-q general \
-n 5 -M 20GB -R "rusage [mem=20GB] span[hosts=1]" \
-cwd $PROJECTDIR \
-J $NAME \
-o $OUTDIR$NAME.stdout.txt \
-a 'docker(sswiston/phylo_docker:slim_amd64)' /bin/bash /project/rev_shell.sh
</code></pre></div></div>

<p>Let’s pick apart the elements of this script. There is a section at the top for defining variables, and then a <code class="language-plaintext highlighter-rouge">bsub</code> command using those variables.</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">LSF_DOCKER_VOLUMES</code> is how you mount a directory to the Docker container for the job. This variable will not be part of the <code class="language-plaintext highlighter-rouge">bsub</code> command itself, but when a new job is starting, it will look for this information. It has two parts.</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">[Storage Directory]:</code> is how you tell Docker where to find your scripts in the cluster’s storage.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">/project</code> is where the directory will be mounted inside the Docker container (in this example). There isn’t a specific place inside the Docker container where you have to mount the directory, and it doesn’t have to have the same name as the directory in the cluster’s storage. Mounting a directory in this way essentially creates a “connection” between the directory on the outside of the container (in the cluster’s storage) and inside the container. While inside the container, your scripts will be able to see all of the contents of a mounted directory, including other sub-directories.</p>
      </li>
    </ul>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">PROJECDIR</code>, <code class="language-plaintext highlighter-rouge">OUTDIR</code>, and <code class="language-plaintext highlighter-rouge">NAME</code> are variables that are used in the <code class="language-plaintext highlighter-rouge">bsub</code> command to specify the project directory, output directory, and job name.</p>
  </li>
</ul>

<p>After defining important variables, there is a multi-line <code class="language-plaintext highlighter-rouge">bsub</code> command that actually submits the job. It has several arguments:</p>

<ul>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-G</code> is the compute group (usually belonging to the lab PI) that the job belongs to.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-q</code> is the queue that the job will join. The <code class="language-plaintext highlighter-rouge">general</code> queue is non-interactive.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-n</code>, <code class="language-plaintext highlighter-rouge">-M</code>, and <code class="language-plaintext highlighter-rouge">-R</code> specify the amount of memory that the job will use.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-cwd</code> sets the working directory inside the Docker container. In this example, note that we use the project directory that we mounted. This is useful because, when the job runs, it will look in this directory for scripts.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-J</code> gives the job a name. This is not strictly necessary, but it is helpful for keeping track of running jobs.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-o</code> creates an output file for the job. Your scripts may save certain products to other files, but this file will record the standard output, including possible job failures.</p>
  </li>
  <li>
    <p><code class="language-plaintext highlighter-rouge">-a</code> is the most important part of the <code class="language-plaintext highlighter-rouge">bsub</code> command. There are 3 parts.</p>

    <ul>
      <li>
        <p><code class="language-plaintext highlighter-rouge">'docker(sswiston/phylo_docker:slim_amd64)'</code> is the Docker image being used. The image will be pulled from Docker Hub.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">/bin/bash</code> is the initial command that will run once the container is open.</p>
      </li>
      <li>
        <p><code class="language-plaintext highlighter-rouge">/project/rev_shell.sh</code> is the script that will run with the <code class="language-plaintext highlighter-rouge">/bin/bash</code> command.</p>
      </li>
    </ul>
  </li>
</ul>

<p>You may wonder why we don’t immediately call RevBayes and run a <code class="language-plaintext highlighter-rouge">.Rev</code> script. This is possible to do. However, the WUSTL RIS cluster overwrites the <code class="language-plaintext highlighter-rouge">PATH</code> variable inside the Docker container, which means that RevBayes can’t be found with a simple <code class="language-plaintext highlighter-rouge">rb</code> command. Instead, you would have to specify the full filepath to the RevBayes binary inside the container, which is <code class="language-plaintext highlighter-rouge">/revbayes/projects/installer/rb</code>. You may also want to add extra information to the <code class="language-plaintext highlighter-rouge">rb</code> command (like defining variables for your analyses). It can be easier to use a shell script to call RevBayes while inside the container. Here is an example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>PATH=$PATH:/revbayes/projects/installer:/revbayes/projects/installer/rb

rb_command="variable_1="test";source(\"/project/rev_script.Rev\");"
echo $rb_command | rb
</code></pre></div></div>

<p>In this short script, RevBayes is added to the <code class="language-plaintext highlighter-rouge">PATH</code> variable inside the container. Then a RevBayes command is constructed. It has two parts: setting <code class="language-plaintext highlighter-rouge">variable_1</code> to have a value of <code class="language-plaintext highlighter-rouge">test</code>, and sourcing the script <code class="language-plaintext highlighter-rouge">rev_script.Rev</code>. The final line pipes this command into RevBayes, which sets <code class="language-plaintext highlighter-rouge">variable_1</code> equal to <code class="language-plaintext highlighter-rouge">test</code> and runs <code class="language-plaintext highlighter-rouge">rev_script.Rev</code>.</p>

<p>This example highlights two main differences between using the RevBayes Docker image on your local machine and using it on the WUSTL RIS computing cluster. First, the analyses must be submitted as jobs (common amongst computing clusters). Second, the job submission process overwrites the <code class="language-plaintext highlighter-rouge">PATH</code> variable inside the Docker container, so you will have to know where to find the programs you want to use. Other computing clusters may have similar challenges. Before running lengthy jobs or batches of jobs, it is recommended that you try out a test job or two and make sure they work as expected. Generally, the Docker image will function the same on any platform, and all of the programs should run correctly with appropriate input scripts.</p>

<ol class="bibliography"></ol>

<script type="text/javascript">
var _ol = document.querySelectorAll('ol');
for (var i = 0, elem_ol; elem_ol = _ol[i]; i++) {
	if ( elem_ol.classList == "bibliography" ) {
		var _li = elem_ol.getElementsByTagName("li");
		//for (var j = 0, elem_li; elem_li = _li[j]; j++)
		//{
		//	elem_li.innerHTML = elem_li.innerHTML.replace(/(https?:\/\/)([^\s<]+)/,"<a href=\"$1$2\">$2");
		//}
		if(_li.length > 0)
			elem_ol.outerHTML = "<h2 class='references'>References</h2><hr class='references'>"+elem_ol.outerHTML
	}
}
</script>

      </div>
      <br>
<footer>
  <div class="container">
  <div class="row">
    <div class="col-sm-12" align="center">
      <a href="https://github.com/revbayes">GitHub</a> | <a href="/license">License</a> | <a href="/citation">Citation</a> | <a href="https://groups.google.com/forum/#!forum/revbayes-users">Users Forum</a>
    </div>
  </div>
  <br>
  </div>
</footer>

    </div>
    <script src="/assets/js/vendor/jquery.min.js"></script>
<script src="/assets/js/vendor/FileSaver.min.js"></script>
<script src="/assets/js/vendor/jszip.min.js"></script>
<script src="/assets/js/vendor/bootstrap.min.js"></script>

<script type="text/javascript">
// Add default language
$(":not(code).highlighter-rouge").each(function() {
  
  if( this.classList == "highlighter-rouge") {
    this.classList = "Rev highlighter-rouge";
  }
  
});
// $("code.highlighter-rouge").each(function() {
//   
//   if( this.classList == "highlighter-rouge") {
//       this.classList = "Rev highlighter-rouge";
//   }
//   
// });
</script>
<script type="text/javascript"
    src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [['$','$'], ['\\(','\\)']],
      processEscapes: true
    }
    });
    MathJax.Hub.Queue(function () {
      $(".aside").each(function() {
          $("div .MathJax", this).hide();
      });
    });
</script>
<script src="/assets/js/base.js"></script>

    <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0Y03X9Q2TJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-0Y03X9Q2TJ');
</script>

  </body>
</html>
